<!DOCTYPE html>
<html>
 
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css?family=M+PLUS+1p" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=M+PLUS+Rounded+1c" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css?family=Hachi+Maru+Pop" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Yusei+Magic" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Reggae+One" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Sawarabi+Gothic" rel="stylesheet">
    <link href="https://fonts.googleapis.com/earlyaccess/nicomoji.css" rel="stylesheet">

    <link href="./font.css" rel="stylesheet">

    <link rel="icon" href="./img/favicon2/favicon.ico" />
    <script src="js/bouyomichan_client.js"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5RNP0LDER8"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-5RNP0LDER8');
    </script>
    <!-- END: Google tag (gtag.js) -->

    <title>jimakuChan: éŸ³å£°èªè­˜å­—å¹•ã¡ã‚ƒã‚“ [CONFIG]</title>

    <style type="text/css">
        /* ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªbox-sizingãƒªã‚»ãƒƒãƒˆ */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        button, input, select, textarea {
            /* font-family : inherit; */
            /* font-family: 'ãƒ¡ã‚¤ãƒªã‚ª', Meiryo,sans-serif; */
            /* font-size   : 300%; */
            /* color  : black; */
            font-weight : 0;
            /*text-align  : center;       /* left, center, right */
            vertical-align : top;    /* top, middle, bottom */
            -webkit-text-stroke-color: rgb(21, 0, 141);
            -webkit-text-stroke-width: 0px;
        }

        html {
            height: 100%;
            width: 100%;
        }

        body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow-x: auto;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            /* font-family:'07NikumaruFont'; */
        }
        table {
            width: 100%;
            /* table-layout: fixed; */
        }
        table.btm_table {
            position:absolute;
            /* bottom:0; */
        }

        table td {
            /*word-break: break-all;*/
            overflow-wrap : break-word;
        }
    </style>

    <style>
        /* prepare the selectors to add a stroke to */

        .stroke-single-imb{
            /* position: absolute; */
            left: 0;
            right: 0;
            margin: 0;
            /* -webkit-text-stroke: 0px #0000FF;  */
        }

        .stroke-single-bg{
            position: absolute;
            left: 0;
            right: 0;
            margin: auto;
            /* -webkit-text-stroke: 3px #FF0000;  */
        }
        /* add a single stroke */
        .stroke-single-fg{
            position: absolute;
            left: 0;
            right: 0;
            margin: auto;
            /* -webkit-text-stroke: 0px #FFFFFF; */
        }
    </style>

</head>
 

<body>

<!-- # æ³¨æ„äº‹é … ######################### -->
<!-- <iframe src="" name="sample" width="100%" height="30%" id="asr_frame" onclick="toggleIframeHeight()"></iframe> -->
<iframe src="" name="sample" width="100%" height="30%" id="asr_frame" onclick="toggleIframeHeight()" style="border: none;"></iframe>

ã€€ä¸Šã®ç”»é¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è¨­å®šç”»é¢ãŒé–‰ã˜ï¼Œã‚‚ã†ä¸€åº¦æŠ¼ã™ã¨å†åº¦é–‹ãã¾ã™ï¼<BR>
<HR>

<!-- # ãƒ—ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ã¨APIã‚­ãƒ¼ ################## -->
<div style="display: flex; gap: 10px; margin-bottom: 5px;">
    <!-- å·¦å´ï¼šè¨­å®šãƒ—ãƒªã‚»ãƒƒãƒˆ -->
    <div style="width: 350px; background-color: #ffe0e6; padding: 8px 10px; border-radius: 5px;">
        <div style="display: flex; align-items: center; gap: 10px;">
            <span style="font-size: 14px; white-space: nowrap;">è¨­å®šãƒ—ãƒªã‚»ãƒƒãƒˆï¼š</span>
            <select id="presetSelect" onchange="loadPreset()" style="flex: 1;">
                <option value="default">ğŸ“‹ é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="gaming">ğŸ® ã‚²ãƒ¼ãƒ é…ä¿¡ç”¨</option>
                <option value="meeting">ğŸ’¼ ä¼šè­°ãƒ»æ‰“ã¡åˆã‚ã›ç”¨</option>
                <option value="language_learning">ğŸ“š èªå­¦å­¦ç¿’ç”¨</option>
                <option value="accessibility">â™¿ ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£é‡è¦–</option>
                <option value="cute_streaming">ğŸŒ¸ ã‹ã‚ã„ã„é…ä¿¡ç”¨</option>
                <option value="dark_theme">ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ</option>
                <option value="rainbow">ğŸŒˆ ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼</option>
                <option value="custom1">ğŸ”§ ã‚«ã‚¹ã‚¿ãƒ ï¼‘</option>
                <option value="custom2">ğŸ”§ ã‚«ã‚¹ã‚¿ãƒ ï¼’</option>
                <option value="custom3">ğŸ”§ ã‚«ã‚¹ã‚¿ãƒ ï¼“</option>
            </select>
        </div>
        <small style="color: #666; font-size: 11px;">â€» é¸æŠã™ã‚‹ã¨è¨­å®šãŒè‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™ âœ¨</small>
    </div>
    
    <!-- å³å´ï¼šAPIã‚­ãƒ¼é–¢é€£ -->
    <div style="flex: 1; background-color: #e0e8ff; padding: 8px 10px; border-radius: 5px;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 3px;">
            <span style="font-size: 14px;">ç¿»è¨³ç”¨ Google API-KEYï¼š</span>
            <input type="text" name="gas_key" id="gas_key" size="30" oninput="updateOptionValues();" style="height: 22px;" />
            <a target="_blank" href="http://www.sayonari.com/trans_asr/index_asr.html" style="font-size: 11px;">[ä½œæˆæ–¹æ³•]</a>
        </div>
        <div style="font-size: 13px;">
            ç¿»è¨³å›æ•°ï¼š<span id="displayTransCount">0</span><span style="color: gray; font-size: 11px;">ï¼ˆç„¡æ–™ä¸Šé™5,000å›ï¼‰</span>
            ã€€ç¿»è¨³ï¼š<span id="translationStatus" style="font-weight: bold; color: #666;">å¾…æ©Ÿä¸­</span>
        </div>
    </div>
</div>
<HR>

<!-- # ãƒ†ã‚­ã‚¹ãƒˆè¨­å®š (ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ) ######################### -->
<table style="border-collapse: separate; border-spacing: 0px;">
<tr>
    <td></td>
    <td style="text-align: center; width: 50px;">æ–‡å­—è‰²</td>
    <td style="text-align: center; width: 50px;">ãƒ•ãƒè‰²</td>
    <td style="text-align: center; width: 120px;">ã‚µã‚¤ã‚º</td>
    <td style="text-align: center; width: 120px;">ã‚¦ã‚§ã‚¤ãƒˆ</td>
    <td style="text-align: center; width: 120px;">ç¸å–ã‚Š</td>
</tr>
<tr>
    <td style="width: 60px;">èªè­˜ã€€ï¼š</td>
    <td style="text-align: center;">
        <input id="color1" type="color" value="#ffffff" oninput="changeTextColor('fg',this.value,1); updateOptionValues(only_url=true)" />
    </td>
    <td style="text-align: center;">
        <input id="st_color1" type="color" value="#000000" oninput="changeTextColor('bg',this.value,1); updateOptionValues(only_url=true)" />
    </td>
    <td style="text-align: center;">
        <input id="size1" type="range" value="25" min="0" max="40" step="0.1" oninput="document.getElementById('asr_frame').contentWindow.document.getElementById('speech_text').style.fontSize = this.value + 'pt'; document.getElementById('text_size_view1').innerHTML=this.value; updateOptionValues(only_url=true)" />
        <span id="text_size_view1">25</span>px
    </td>
    <td style="text-align: center;">
        <input id="weight1" type="range" value="900" min="100" max="900" step="100" oninput="document.getElementById('asr_frame').contentWindow.document.getElementById('speech_text').style.fontWeight = this.value; document.getElementById('text_weight_view1').innerHTML=this.value; updateOptionValues(only_url=true)" />
        <span id="text_weight_view1">900</span>
    </td>
    <td style="text-align: center;">
        <input id="st_width1" type="range" value="6" min="0" max="20" step="0.1" oninput="setTextBorder(this.value,1); document.getElementById('text_st_size_view1').innerHTML=this.value; updateOptionValues(only_url=true)" />
        <span id="text_st_size_view1">6</span>pt
    </td>
</tr>
<tr>
    <td>ç¿»è¨³ï¼‘ï¼š</td>
    <td style="text-align: center;">
        <input id="color2" type="color" value="#ffffff" oninput="changeTextColor('fg',this.value,2); updateOptionValues(only_url=true)" />
    </td>
    <td style="text-align: center;">
        <input id="st_color2" type="color" value="#000000" oninput="changeTextColor('bg',this.value,2); updateOptionValues(only_url=true)" />
    </td>
    <td style="text-align: center;">
        <input id="size2" type="range" value="25" min="0" max="40" step="0.1" oninput="document.getElementById('asr_frame').contentWindow.document.getElementById('trans_text').style.fontSize = this.value + 'pt'; document.getElementById('text_size_view2').innerHTML=this.value; updateOptionValues(only_url=true)" />
        <span id="text_size_view2">25</span>px
    </td>
    <td style="text-align: center;">
        <input id="weight2" type="range" value="900" min="100" max="900" step="100" oninput="document.getElementById('asr_frame').contentWindow.document.getElementById('trans_text').style.fontWeight = this.value; document.getElementById('text_weight_view2').innerHTML=this.value; updateOptionValues(only_url=true)" />
        <span id="text_weight_view2">900</span>
    </td>
    <td style="text-align: center;">
        <input id="st_width2" type="range" value="6" min="0" max="20" step="0.1" oninput="setTextBorder(this.value,2); document.getElementById('text_st_size_view2').innerHTML=this.value; updateOptionValues(only_url=true)" />
        <span id="text_st_size_view2">6</span>pt
    </td>
</tr>
<tr>
    <td>ç¿»è¨³ï¼’ï¼š</td>
    <td style="text-align: center;">
        <input id="color3" type="color" value="#ffffff" oninput="changeTextColor('fg',this.value,3); updateOptionValues(only_url=true)" />
    </td>
    <td style="text-align: center;">
        <input id="st_color3" type="color" value="#000000" oninput="changeTextColor('bg',this.value,3); updateOptionValues(only_url=true)" />
    </td>
    <td style="text-align: center;">
        <input id="size3" type="range" value="25" min="0" max="40" step="0.1" oninput="document.getElementById('asr_frame').contentWindow.document.getElementById('trans_text2').style.fontSize = this.value + 'pt'; document.getElementById('text_size_view3').innerHTML=this.value; updateOptionValues(only_url=true)" />
        <span id="text_size_view3">25</span>px
    </td>
    <td style="text-align: center;">
        <input id="weight3" type="range" value="900" min="100" max="900" step="100" oninput="document.getElementById('asr_frame').contentWindow.document.getElementById('trans_text2').style.fontWeight = this.value; document.getElementById('text_weight_view3').innerHTML=this.value; updateOptionValues(only_url=true)" />
        <span id="text_weight_view3">900</span>
    </td>
    <td style="text-align: center;">
        <input id="st_width3" type="range" value="6" min="0" max="20" step="0.1" oninput="setTextBorder(this.value,3); document.getElementById('text_st_size_view3').innerHTML=this.value; updateOptionValues(only_url=true)" />
        <span id="text_st_size_view3">6</span>pt
    </td>
</tr>
<tr>
    <td>ç¿»è¨³ï¼“ï¼š</td>
    <td style="text-align: center;">
        <input id="color4" type="color" value="#ffffff" oninput="changeTextColor('fg',this.value,4); updateOptionValues(only_url=true)" />
    </td>
    <td style="text-align: center;">
        <input id="st_color4" type="color" value="#000000" oninput="changeTextColor('bg',this.value,4); updateOptionValues(only_url=true)" />
    </td>
    <td style="text-align: center;">
        <input id="size4" type="range" value="25" min="0" max="40" step="0.1" oninput="document.getElementById('asr_frame').contentWindow.document.getElementById('trans_text3').style.fontSize = this.value + 'pt'; document.getElementById('text_size_view4').innerHTML=this.value; updateOptionValues(only_url=true)" />
        <span id="text_size_view4">25</span>px
    </td>
    <td style="text-align: center;">
        <input id="weight4" type="range" value="900" min="100" max="900" step="100" oninput="document.getElementById('asr_frame').contentWindow.document.getElementById('trans_text3').style.fontWeight = this.value; document.getElementById('text_weight_view4').innerHTML=this.value; updateOptionValues(only_url=true)" />
        <span id="text_weight_view4">900</span>
    </td>
    <td style="text-align: center;">
        <input id="st_width4" type="range" value="6" min="0" max="20" step="0.1" oninput="setTextBorder(this.value,4); document.getElementById('text_st_size_view4').innerHTML=this.value; updateOptionValues(only_url=true)" />
        <span id="text_st_size_view4">6</span>pt
    </td>
</tr>
</table>

èƒŒæ™¯è‰²ï¼š<input id="bgcolor" type="color" value="#00ff00" oninput="document.getElementById('asr_frame').contentWindow.document.bgColor=this.value; changeTextColor('imb',this.value,1); updateOptionValues(only_url=true)" />

<HR>

<!-- # è¨€èªé¸æŠè¨­å®š ######################### -->
éŸ³å£°èªè­˜è¨€èªã€€ï¼š
<select id="recog" onchange="updateOptionValues(only_url=false);">
    <option value="ja" selected>æ—¥æœ¬èª</option>
    <option value="en-US">è‹±èª</option>
    <option value="ko">éŸ“å›½èª</option>
    <option value="zh-CN">ä¸­å›½èª</option>
    <option value="zh-TW">å°æ¹¾èª</option>
    <option value="zh-HK">é¦™æ¸¯èª</option>
    <option value="fr-FR">ãƒ•ãƒ©ãƒ³ã‚¹èª</option>
    <option value="it-IT">ã‚¤ã‚¿ãƒªã‚¢èª</option>
    <option value="de-DE">ãƒ‰ã‚¤ãƒ„èª</option>
    <option value="tr-TR">ãƒˆãƒ«ã‚³èª</option>
    <option value="sv-SE">ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³èª</option>
    <option value="pl-PL">ãƒãƒ¼ãƒ©ãƒ³ãƒ‰èª</option>
    <option value="uk-UA">ã‚¦ã‚¯ãƒ©ã‚¤ãƒŠèª</option>
    <option value="ru-RU">ãƒ­ã‚·ã‚¢èª</option>
    <option value="es-ES">ã‚¹ãƒšã‚¤ãƒ³èª</option>
    <option value="pt-PT">ãƒãƒ«ãƒˆã‚¬ãƒ«èª</option>
    <option value="nl-NL">ã‚ªãƒ©ãƒ³ãƒ€èª</option>
    <option value="id-ID">ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢èª</option>
    <option value="vi-VN">ãƒ™ãƒˆãƒŠãƒ èª</option>
    <option value="th-TH">ã‚¿ã‚¤èª</option>
    <option value="ar-SA">ã‚¢ãƒ©ãƒ“ã‚¢èª</option>
    <option value="el-GR">ã‚®ãƒªã‚·ãƒ£èª</option>
</select>ã€€ã€€

ãƒ•ã‚©ãƒ³ãƒˆã€€ï¼š
<select name="speech_text_font_selector" id="speech_text_font_selector" onchange="applySelectedFont(this, 'speech_text'); selectFont(); updateOptionValues();">
    <option value="direct">[PCå†…ãƒ•ã‚©ãƒ³ãƒˆ]</option>
    <option value="M PLUS\\ 1p">M PLUS 1p</option>
    <option value="M PLUS Rounded\\ 1c" selected>M PLUS Rounded 1c</option>
    <option value="Mamelon">ãƒãƒ¡ãƒ­ãƒ³</option>
    <option value="YasashisaB">ã‚„ã•ã—ã•B</option>
    <option value="HuiFont29">ãµã„å­—</option>
    <option value="Hachi Maru Pop">Hachi Maru Pop</option>
    <option value="MkPOP">851ãƒã‚«ãƒãƒƒãƒ—</option>
    <option value="bananaslipplus">ãƒãƒŠãƒŠã‚¹ãƒªãƒƒãƒ—plus</option>
    <option value="katyou">èŠ±é³¥é¢¨æœˆ</option>
    <option value="TanukiMagic">ãŸã¬ãæ²¹æ€§ãƒã‚¸ãƒƒã‚¯</option>
    <option value="hakidame">åãæºœ</option>
    <option value="umeboshi">æ¢…å¹²ã—</option>
    <option value="Jiyucho">ã˜ã‚†ã†ã¡ã‚‡ã†</option>
    <option value="HitmoR">Hitmo</option>
    <option value="nishikiteki">ã«ã—ãçš„</option>
    <option value="Yusei Magic">Yusei Magic</option>
    <option value="Nikumaru">ã«ãã¾ã‚‹</option>
    <option value="KTEGAKI">kawaiiæ‰‹æ›¸ã</option>
    <option value="JKGL">JK Gothic L</option>
    <option value="Reggae One">Reggae One</option>
    <option value="OhisamaFont">ãŠã²ã•ã¾</option>
    <option value="nukamiso">ã¬ã‹ã¿ã</option>
    <option value="genkai">æºç•Œæ˜æœ</option>
    <option value="CP">ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ</option>
    <option value="Noto Sans JP">Noto Sans JP</option>
    <option value="Sawarabi Gothic">ã•ã‚ã‚‰ã³ã‚´ã‚·ãƒƒã‚¯</option>
    <option value="Nico Moji">ãƒ‹ã‚³ãƒ¢ã‚¸</option>
</select>ã€€
PCå†…ãƒ•ã‚©ãƒ³ãƒˆï¼š<select id="speech_text_system_font" onchange="applySystemFont(this.value, 'speech_text'); updateOptionValues();"></select>
<input type="text" id="speech_text_direct_font" placeholder="ãƒ•ã‚©ãƒ³ãƒˆåã‚’å…¥åŠ›" style="width: 200px; margin-left: 10px;" disabled oninput="applyDirectFont(this.value, 'speech_text'); updateOptionValues();">
<span id="font_api_status" style="font-size: 12px; margin-left: 10px;"></span><br>

ç¿»è¨³è¨€èªï¼ˆï¼‘ï¼‰ï¼š
<select id="trans" onchange="updateOptionValues(only_url=false);">
    <option value="none" selected>ãªã—</option>
    <option value="ja">æ—¥æœ¬èª</option>
    <option value="en">è‹±èª</option>
    <option value="ko">éŸ“å›½èª</option>
    <option value="zh-CN">ä¸­å›½èª</option>
    <option value="zh-TW">å°æ¹¾èª</option>
    <option value="zh-HK">é¦™æ¸¯èª</option>
    <option value="fr">ãƒ•ãƒ©ãƒ³ã‚¹èª</option>
    <option value="it">ã‚¤ã‚¿ãƒªã‚¢èª</option>
    <option value="de">ãƒ‰ã‚¤ãƒ„èª</option>
    <option value="tr">ãƒˆãƒ«ã‚³èª</option>
    <option value="sv">ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³èª</option>
    <option value="pl">ãƒãƒ¼ãƒ©ãƒ³ãƒ‰èª</option>
    <option value="uk">ã‚¦ã‚¯ãƒ©ã‚¤ãƒŠèª</option>
    <option value="ru">ãƒ­ã‚·ã‚¢èª</option>
    <option value="es">ã‚¹ãƒšã‚¤ãƒ³èª</option>
    <option value="pt">ãƒãƒ«ãƒˆã‚¬ãƒ«èª</option>
    <option value="nl">ã‚ªãƒ©ãƒ³ãƒ€èª</option>
    <option value="id">ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢èª</option>
    <option value="vi">ãƒ™ãƒˆãƒŠãƒ èª</option>
    <option value="th">ã‚¿ã‚¤èª</option>
    <option value="ar">ã‚¢ãƒ©ãƒ“ã‚¢èª</option>
    <option value="so">ã‚½ãƒãƒªèª</option>
    <option value="el">ã‚®ãƒªã‚·ãƒ£èª</option>
</select>ã€€ã€€

ãƒ•ã‚©ãƒ³ãƒˆã€€ï¼š
<select name="trans_text_font_selector" id="trans_text_font_selector" onchange="applySelectedFont(this, 'trans_text'); selectFont(); updateOptionValues();">
    <option value="direct">[PCå†…ãƒ•ã‚©ãƒ³ãƒˆ]</option>
    <option value="M PLUS\\ 1p">M PLUS 1p</option>
    <option value="M PLUS Rounded\\ 1c" selected>M PLUS Rounded 1c</option>
    <option value="Mamelon">ãƒãƒ¡ãƒ­ãƒ³</option>
    <option value="YasashisaB">ã‚„ã•ã—ã•B</option>
    <option value="HuiFont29">ãµã„å­—</option>
    <option value="Hachi Maru Pop">Hachi Maru Pop</option>
    <option value="MkPOP">851ãƒã‚«ãƒãƒƒãƒ—</option>
    <option value="bananaslipplus">ãƒãƒŠãƒŠã‚¹ãƒªãƒƒãƒ—plus</option>
    <option value="katyou">èŠ±é³¥é¢¨æœˆ</option>
    <option value="TanukiMagic">ãŸã¬ãæ²¹æ€§ãƒã‚¸ãƒƒã‚¯</option>
    <option value="hakidame">åãæºœ</option>
    <option value="umeboshi">æ¢…å¹²ã—</option>
    <option value="Jiyucho">ã˜ã‚†ã†ã¡ã‚‡ã†</option>
    <option value="HitmoR">Hitmo</option>
    <option value="nishikiteki">ã«ã—ãçš„</option>
    <option value="Yusei Magic">Yusei Magic</option>
    <option value="Nikumaru">ã«ãã¾ã‚‹</option>
    <option value="KTEGAKI">kawaiiæ‰‹æ›¸ã</option>
    <option value="JKGL">JK Gothic L</option>
    <option value="Reggae One">Reggae One</option>
    <option value="OhisamaFont">ãŠã²ã•ã¾</option>
    <option value="nukamiso">ã¬ã‹ã¿ã</option>
    <option value="genkai">æºç•Œæ˜æœ</option>
    <option value="CP">ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ</option>
    <option value="Noto Sans JP">Noto Sans JP</option>
    <option value="Sawarabi Gothic">ã•ã‚ã‚‰ã³ã‚´ã‚·ãƒƒã‚¯</option>
    <option value="Nico Moji">ãƒ‹ã‚³ãƒ¢ã‚¸</option>
</select>ã€€
PCå†…ãƒ•ã‚©ãƒ³ãƒˆï¼š<select id="trans_text_system_font" onchange="applySystemFont(this.value, 'trans_text'); updateOptionValues();"></select>
<input type="text" id="trans_text_direct_font" placeholder="ãƒ•ã‚©ãƒ³ãƒˆåã‚’å…¥åŠ›" style="width: 200px; margin-left: 10px;" disabled oninput="applyDirectFont(this.value, 'trans_text'); updateOptionValues();"><br>

ç¿»è¨³è¨€èªï¼ˆï¼’ï¼‰ï¼š
<select id="trans2" onchange="updateOptionValues(only_url=false);">
    <option value="none" selected>ãªã—</option>
    <option value="ja">æ—¥æœ¬èª</option>
    <option value="en">è‹±èª</option>
    <option value="ko">éŸ“å›½èª</option>
    <option value="zh-CN">ä¸­å›½èª</option>
    <option value="zh-TW">å°æ¹¾èª</option>
    <option value="zh-HK">é¦™æ¸¯èª</option>
    <option value="fr">ãƒ•ãƒ©ãƒ³ã‚¹èª</option>
    <option value="it">ã‚¤ã‚¿ãƒªã‚¢èª</option>
    <option value="de">ãƒ‰ã‚¤ãƒ„èª</option>
    <option value="tr">ãƒˆãƒ«ã‚³èª</option>
    <option value="sv">ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³èª</option>
    <option value="pl">ãƒãƒ¼ãƒ©ãƒ³ãƒ‰èª</option>
    <option value="uk">ã‚¦ã‚¯ãƒ©ã‚¤ãƒŠèª</option>
    <option value="ru">ãƒ­ã‚·ã‚¢èª</option>
    <option value="es">ã‚¹ãƒšã‚¤ãƒ³èª</option>
    <option value="pt">ãƒãƒ«ãƒˆã‚¬ãƒ«èª</option>
    <option value="nl">ã‚ªãƒ©ãƒ³ãƒ€èª</option>
    <option value="id">ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢èª</option>
    <option value="vi">ãƒ™ãƒˆãƒŠãƒ èª</option>
    <option value="th">ã‚¿ã‚¤èª</option>
    <option value="ar">ã‚¢ãƒ©ãƒ“ã‚¢èª</option>
    <option value="so">ã‚½ãƒãƒªèª</option>
    <option value="el">ã‚®ãƒªã‚·ãƒ£èª</option>
</select>ã€€ã€€

ãƒ•ã‚©ãƒ³ãƒˆã€€ï¼š
<select name="trans_text2_font_selector" id="trans_text2_font_selector" onchange="applySelectedFont(this, 'trans_text2'); selectFont(); updateOptionValues();">
    <option value="direct">[PCå†…ãƒ•ã‚©ãƒ³ãƒˆ]</option>
    <option value="M PLUS\\ 1p">M PLUS 1p</option>
    <option value="M PLUS Rounded\\ 1c" selected>M PLUS Rounded 1c</option>
    <option value="Mamelon">ãƒãƒ¡ãƒ­ãƒ³</option>
    <option value="YasashisaB">ã‚„ã•ã—ã•B</option>
    <option value="HuiFont29">ãµã„å­—</option>
    <option value="Hachi Maru Pop">Hachi Maru Pop</option>
    <option value="MkPOP">851ãƒã‚«ãƒãƒƒãƒ—</option>
    <option value="bananaslipplus">ãƒãƒŠãƒŠã‚¹ãƒªãƒƒãƒ—plus</option>
    <option value="katyou">èŠ±é³¥é¢¨æœˆ</option>
    <option value="TanukiMagic">ãŸã¬ãæ²¹æ€§ãƒã‚¸ãƒƒã‚¯</option>
    <option value="hakidame">åãæºœ</option>
    <option value="umeboshi">æ¢…å¹²ã—</option>
    <option value="Jiyucho">ã˜ã‚†ã†ã¡ã‚‡ã†</option>
    <option value="HitmoR">Hitmo</option>
    <option value="nishikiteki">ã«ã—ãçš„</option>
    <option value="Yusei Magic">Yusei Magic</option>
    <option value="Nikumaru">ã«ãã¾ã‚‹</option>
    <option value="KTEGAKI">kawaiiæ‰‹æ›¸ã</option>
    <option value="JKGL">JK Gothic L</option>
    <option value="Reggae One">Reggae One</option>
    <option value="OhisamaFont">ãŠã²ã•ã¾</option>
    <option value="nukamiso">ã¬ã‹ã¿ã</option>
    <option value="genkai">æºç•Œæ˜æœ</option>
    <option value="CP">ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ</option>
    <option value="Noto Sans JP">Noto Sans JP</option>
    <option value="Sawarabi Gothic">ã•ã‚ã‚‰ã³ã‚´ã‚·ãƒƒã‚¯</option>
    <option value="Nico Moji">ãƒ‹ã‚³ãƒ¢ã‚¸</option>
</select>ã€€
PCå†…ãƒ•ã‚©ãƒ³ãƒˆï¼š<select id="trans_text2_system_font" onchange="applySystemFont(this.value, 'trans_text2'); updateOptionValues();"></select>
<input type="text" id="trans_text2_direct_font" placeholder="ãƒ•ã‚©ãƒ³ãƒˆåã‚’å…¥åŠ›" style="width: 200px; margin-left: 10px;" disabled oninput="applyDirectFont(this.value, 'trans_text2'); updateOptionValues();"><br>

ç¿»è¨³è¨€èªï¼ˆï¼“ï¼‰ï¼š
<select id="trans3" onchange="updateOptionValues(only_url=false);">
    <option value="none" selected>ãªã—</option>
    <option value="ja">æ—¥æœ¬èª</option>
    <option value="en">è‹±èª</option>
    <option value="ko">éŸ“å›½èª</option>
    <option value="zh-CN">ä¸­å›½èª</option>
    <option value="zh-TW">å°æ¹¾èª</option>
    <option value="zh-HK">é¦™æ¸¯èª</option>
    <option value="fr">ãƒ•ãƒ©ãƒ³ã‚¹èª</option>
    <option value="it">ã‚¤ã‚¿ãƒªã‚¢èª</option>
    <option value="de">ãƒ‰ã‚¤ãƒ„èª</option>
    <option value="tr">ãƒˆãƒ«ã‚³èª</option>
    <option value="sv">ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³èª</option>
    <option value="pl">ãƒãƒ¼ãƒ©ãƒ³ãƒ‰èª</option>
    <option value="uk">ã‚¦ã‚¯ãƒ©ã‚¤ãƒŠèª</option>
    <option value="ru">ãƒ­ã‚·ã‚¢èª</option>
    <option value="es">ã‚¹ãƒšã‚¤ãƒ³èª</option>
    <option value="pt">ãƒãƒ«ãƒˆã‚¬ãƒ«èª</option>
    <option value="nl">ã‚ªãƒ©ãƒ³ãƒ€èª</option>
    <option value="id">ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢èª</option>
    <option value="vi">ãƒ™ãƒˆãƒŠãƒ èª</option>
    <option value="th">ã‚¿ã‚¤èª</option>
    <option value="ar">ã‚¢ãƒ©ãƒ“ã‚¢èª</option>
    <option value="so">ã‚½ãƒãƒªèª</option>
    <option value="el">ã‚®ãƒªã‚·ãƒ£èª</option>
</select>ã€€ã€€

ãƒ•ã‚©ãƒ³ãƒˆã€€ï¼š
<select name="trans_text3_font_selector" id="trans_text3_font_selector" onchange="applySelectedFont(this, 'trans_text3'); selectFont(); updateOptionValues();">
    <option value="direct">[PCå†…ãƒ•ã‚©ãƒ³ãƒˆ]</option>
    <option value="M PLUS\\ 1p">M PLUS 1p</option>
    <option value="M PLUS Rounded\\ 1c" selected>M PLUS Rounded 1c</option>
    <option value="Mamelon">ãƒãƒ¡ãƒ­ãƒ³</option>
    <option value="YasashisaB">ã‚„ã•ã—ã•B</option>
    <option value="HuiFont29">ãµã„å­—</option>
    <option value="Hachi Maru Pop">Hachi Maru Pop</option>
    <option value="MkPOP">851ãƒã‚«ãƒãƒƒãƒ—</option>
    <option value="bananaslipplus">ãƒãƒŠãƒŠã‚¹ãƒªãƒƒãƒ—plus</option>
    <option value="katyou">èŠ±é³¥é¢¨æœˆ</option>
    <option value="TanukiMagic">ãŸã¬ãæ²¹æ€§ãƒã‚¸ãƒƒã‚¯</option>
    <option value="hakidame">åãæºœ</option>
    <option value="umeboshi">æ¢…å¹²ã—</option>
    <option value="Jiyucho">ã˜ã‚†ã†ã¡ã‚‡ã†</option>
    <option value="HitmoR">Hitmo</option>
    <option value="nishikiteki">ã«ã—ãçš„</option>
    <option value="Yusei Magic">Yusei Magic</option>
    <option value="Nikumaru">ã«ãã¾ã‚‹</option>
    <option value="KTEGAKI">kawaiiæ‰‹æ›¸ã</option>
    <option value="JKGL">JK Gothic L</option>
    <option value="Reggae One">Reggae One</option>
    <option value="OhisamaFont">ãŠã²ã•ã¾</option>
    <option value="nukamiso">ã¬ã‹ã¿ã</option>
    <option value="genkai">æºç•Œæ˜æœ</option>
    <option value="CP">ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ</option>
    <option value="Noto Sans JP">Noto Sans JP</option>
    <option value="Sawarabi Gothic">ã•ã‚ã‚‰ã³ã‚´ã‚·ãƒƒã‚¯</option>
    <option value="Nico Moji">ãƒ‹ã‚³ãƒ¢ã‚¸</option>
</select>ã€€
PCå†…ãƒ•ã‚©ãƒ³ãƒˆï¼š<select id="trans_text3_system_font" onchange="applySystemFont(this.value, 'trans_text3'); updateOptionValues();"></select>
<input type="text" id="trans_text3_direct_font" placeholder="ãƒ•ã‚©ãƒ³ãƒˆåã‚’å…¥åŠ›" style="width: 200px; margin-left: 10px;" disabled oninput="applyDirectFont(this.value, 'trans_text3'); updateOptionValues();"><br>

<HR>
<!-- # è¡Œé–“èª¿æ•´ ######################### -->
<div style="background-color: #f0f0f0; padding: 8px; border-radius: 5px; margin: 5px 0;">
    <strong>è¡Œé–“ï¼š</strong>
    èªè­˜â†’ç¿»è¨³ï¼‘
    <input type="range" id="line_spacing_1" min="0" max="50" value="0" 
           oninput="document.getElementById('line_spacing_1_value').textContent = this.value + 'px'; updateLineSpacing('speech_text', this.value); updateOptionValues();"
           style="width: 80px; vertical-align: middle;">
    <span id="line_spacing_1_value" style="display: inline-block; width: 35px; text-align: right;">0px</span>
    ã€€
    ç¿»è¨³ï¼‘â†’ï¼’
    <input type="range" id="line_spacing_2" min="0" max="50" value="0" 
           oninput="document.getElementById('line_spacing_2_value').textContent = this.value + 'px'; updateLineSpacing('trans_text', this.value); updateOptionValues();"
           style="width: 80px; vertical-align: middle;">
    <span id="line_spacing_2_value" style="display: inline-block; width: 35px; text-align: right;">0px</span>
    ã€€
    ç¿»è¨³ï¼’â†’ï¼“
    <input type="range" id="line_spacing_3" min="0" max="50" value="0" 
           oninput="document.getElementById('line_spacing_3_value').textContent = this.value + 'px'; updateLineSpacing('trans_text2', this.value); updateOptionValues();"
           style="width: 80px; vertical-align: middle;">
    <span id="line_spacing_3_value" style="display: inline-block; width: 35px; text-align: right;">0px</span>
</div>

<HR>
<!-- # ãƒ†ã‚­ã‚¹ãƒˆã®æƒãˆ ######################### -->
ãƒ†ã‚­ã‚¹ãƒˆã®ä½ç½®ï¼šã€€
å·¦å³ï¼š
<select id="textAlign" onchange="updateOptionValues()">
    <option value="left">å·¦å¯„ã›</option>
    <option value="center" selected>ä¸­å¤®å¯„ã›</option>
    <option value="right">å³å¯„ã›</option>
</select>

ã€€ä¸Šä¸‹ï¼š
<select id="v_align" onchange="updateOptionValues()">
    <option value="top" selected>ä¸Š</option>
    <option value="bottom">ä¸‹</option>
</select><BR>

<!-- # ãƒ†ã‚­ã‚¹ãƒˆã®æ”¹è¡Œ ######################### -->
ãƒ†ã‚­ã‚¹ãƒˆã®æ”¹è¡Œï¼š
<select id="whiteSpace" onchange="updateOptionValues()">
    <option value="nowrap">æ”¹è¡Œã—ãªã„</option>
    <option value="" selected>ç”»é¢ç«¯ã§æ”¹è¡Œ</option>
</select><BR>
<HR>


<div id="audioLevelMeter" style="margin: 5px 0;">
    éŸ³å£°ãƒ¬ãƒ™ãƒ«: <div style="display: inline-block; width: 200px; height: 10px; border: 1px solid #ccc; background: #f0f0f0; position: relative; overflow: hidden;">
        <div style="position: absolute; width: 100%; height: 100%; background: linear-gradient(to right, #4CAF50 0%, #4CAF50 50%, #FFC107 75%, #FF5722 100%);"></div>
        <div id="audioLevelCover" style="position: absolute; right: 0; width: 100%; height: 100%; background: #f0f0f0; transition: width 0.1s;"></div>
    </div> <span id="audioLevelText">0%</span>
</div>







<HR>

<!-- # ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã‚’â—ç§’å¾Œã«æ¶ˆã™ ######################### -->
ä½•ãƒŸãƒªç§’å¾Œã«æ–‡ã‚’æ¶ˆã™ï¼Ÿã€€ã€€ã€€ï¼šã€€
<input type="text" name="timer" id="timer" size="10" oninput="updateOptionValues();" />ãƒŸãƒªç§’ã€€
<span style="display: inline-block; vertical-align: middle;">
    <!-- éŸ³å£°èªè­˜ç”¨ã‚¿ã‚¤ãƒãƒ¼ãƒãƒ¼ï¼ˆå·¦ï¼‰ -->
    <div id="speechTimerProgressContainer" style="display: inline-block; width: 140px; height: 26px; background: linear-gradient(135deg, #fff5f5 0%, #ffd0cc 100%); border: 2px solid #cc8888; border-radius: 13px; margin-left: 10px; position: relative; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
        <div id="speechTimerProgressBar" style="height: 100%; background: linear-gradient(90deg, #FF6B6B 0%, #FFA07A 50%, #FFE4E1 100%); width: 0%; transition: width 0.1s linear; border-radius: 11px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
        <div id="speechTimerProgressText" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 13px; font-weight: bold; color: #333; text-shadow: 1px 1px 2px rgba(255,255,255,0.8); letter-spacing: 0.5px;">ğŸ¤å¾…æ©Ÿ</div>
    </div>
    <!-- ç¿»è¨³ç”¨ã‚¿ã‚¤ãƒãƒ¼ãƒãƒ¼ï¼ˆå³ï¼‰ -->
    <div id="transTimerProgressContainer" style="display: inline-block; width: 140px; height: 26px; background: linear-gradient(135deg, #f0f8ff 0%, #cce7ff 100%); border: 2px solid #8888cc; border-radius: 13px; margin-left: 8px; position: relative; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
        <div id="transTimerProgressBar" style="height: 100%; background: linear-gradient(90deg, #2196F3 0%, #64B5F6 50%, #BBDEFB 100%); width: 0%; transition: width 0.1s linear; border-radius: 11px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
        <div id="transTimerProgressText" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 13px; font-weight: bold; color: #333; text-shadow: 1px 1px 2px rgba(255,255,255,0.8); letter-spacing: 0.5px;">ğŸŒå¾…æ©Ÿ</div>
    </div>
</span><BR>

<!-- # æ–‡ã®çµ‚ã‚ã‚Š ######################### -->
ä½•ãƒŸãƒªç§’é»™ã£ãŸã‚‰æ–‡ã‚’åŒºåˆ‡ã‚‹ï¼Ÿï¼šã€€
<input type="text" name="short_pause" value="750" id="short_pause" size="10" oninput="updateOptionValues();" />ãƒŸãƒªç§’ï¼ˆåŠè§’æ•°å­—ã§å…¥ã‚Œã¦ã­ï¼1000ãƒŸãƒªç§’ = 1ç§’ï¼‰<BR>
ï¼ˆ500ï¼šã™ãåˆ‡ã‚‹ï½œ750ï¼šæ™®é€šï½œ1000ï¼šã¤ãªãã€€èª¿æ•´ã—ã¦ï¼ä½•ã‚‚å…¥ã‚Œãªã„ã¨ï¼Œã“ã‚Œã¾ã§ã¨åŒã˜å‹•ä½œã«ãªã‚‹ï¼ï¼‰<BR>
<HR>


<!-- # æ£’èª­ã¿ã¡ã‚ƒã‚“é€£æº ######################### -->
- æ£’èª­ã¿ã¡ã‚ƒã‚“é€£æºã‚’ä½¿ã†ï¼š<input type="checkbox" id="bouyomi" onchange="updateOptionValues()"> â† ä½¿ã†å ´åˆãƒã‚§ãƒƒã‚¯å…¥ã‚Œã‚‹ï¼è©³ç´° â†’ <a target="_blank" href="https://twitter.com/sayonari/status/1386937837682003968">twitter</a><BR>
<!-- # ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ãƒ¯ãƒ¼ãƒ‰å¯¾å¿œã™ã‚‹ï¼ ######################### -->
- ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ãƒ¯ãƒ¼ãƒ‰å¯¾å¿œï¼ˆ***ã«ç½®ãæ›ãˆï¼‰ã‚’<font color="red">ã‚„ã‚ã‚‹</font>ï¼š<input type="checkbox" id="anti_sexual" onchange="updateOptionValues()"> <BR>
<HR>

<!-- # URL view & copy button ############### -->
<!-- URL :  -->
<!-- <textarea name="url" id="url" rows="7" cols="90"></textarea><BR> -->
<!-- ã€€ã€€ã€€<input type="button" value="copy to clipboard" id="textarea_copy" onclick="document.getElementsByTagName('textarea')[0].select();document.execCommand('copy');"> -->
<!-- ã€€<a id="open_link" target="_self" href="">[åŒã˜ã‚¿ãƒ–ã§é–‹ã]</a><BR>
åˆ¥çª“ã§é–‹ãã¨ï¼’ã¤èµ·å‹•ã—ã¦ä¸¡æ–¹æ­¢ã¾ã‚‹ã‚ˆï¼å¤šé‡èµ·å‹•ã—ãªã„ã‚ˆã†ã«æ°—ã‚’ã¤ã‘ã¦ï¼<BR> -->
<!-- <HR> -->

<!-- # è¨­å®šã‚»ãƒ¼ãƒ–ï¼†ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ ################## -->
ã€€<button onclick="saveSettings()">è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’PCã«ä¿å­˜</button>ã€€
<button onclick="loadSettings()">è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«èª­è¾¼</button>ã€€ï¼šè¨­å®šãŒå®Œæˆã—ãŸã‚‰ï¼Œè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€€<BR>

<HR>

<!-- # .bat download ãƒœã‚¿ãƒ³ ############################## -->
.bat ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆï¼š<BR>
ã“ã‚Œä½¿ã£ãŸã‚‰ï¼Œ<font color="red">å…¨ç”»é¢ã‚²ãƒ¼ãƒ ã—ã¦ã¦ã‚‚æ­¢ã¾ã‚‰ãªã„ï¼</font>è©³ã—ãã¯ã“ã¡ã‚‰â†’ï¼ˆ<a target="_blank" href="https://www.youtube.com/watch?v=8-UXx_tVeYk">è§£èª¬å‹•ç”»</a>ï¼‰<BR>
.batãƒ•ã‚¡ã‚¤ãƒ«ã¨ï¼Œè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ï¼<BR>

<table border="1" style="width: auto;"><tr><td>
<table style="width: auto;">
    <tr>
        <td width="180">Windowsã®äººï¼š</td>
        <td><button onclick="generateBatFile('win')">Windowsç”¨ èµ·å‹• .batãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ</button></td>
        <td><button onclick="saveSettings()">è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’PCã«ä¿å­˜</button></td>
    </tr>
</tr>
</table>
</td></tr></table>
<BR>
    
<table border="1" style="width: auto;"><tr><td>
<table style="width: auto;">
    <tr>
        <td width="180">Macã®äººï¼š</td>
        <td><button onclick="generateBatFile('mac')">Macç”¨ èµ·å‹• .commandãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ</button></td>
        <td><button onclick="saveSettings()">è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’PCã«ä¿å­˜</button></td>
    </tr>
</table>
</td></tr></table>

<HR>

<!-- # dummy è¦‹ãˆãªã„æ•°å­— ############################## -->
<input style="display: none;" type="text" name="frame_height" id="frame_height" value="30%" size="10" oninput="updateOptionValues();" />


<BR><BR><BR>
</div><BR>
</body>










<!-- # ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ########################################### -->

<!-- # å­—å¹•ã¡ã‚ƒã‚“è¨­å®šé …ç›®ã®ãƒ­ãƒ¼ãƒ‰ã¨ï¼Œç”»é¢ã¸ã®åæ˜  ############################## -->
<script type="text/javascript">
    const currentURL = window.location.origin + window.location.pathname;
    let base_url = currentURL.replace("index.html", "");
    base_url += "main.html?";
    base_url = base_url.replace("??", "?");


    // config å€¤ã€€ä¸€è¦§ ////////////////
    config_values = ["gas_key", "textAlign", "v_align", "whiteSpace", "bgcolor", "frame_height"
        , "recog", "size1", "weight1", "color1", "st_color1", "st_width1"
        , "trans", "size2", "weight2", "color2", "st_color2", "st_width2"
        , "trans2", "size3", "weight3", "color3", "st_color3", "st_width3"
        , "trans3", "size4", "weight4", "color4", "st_color4", "st_width4"
        , "timer", "short_pause"
        , "bouyomi", "anti_sexual"
        , "speech_text_font_selector", "trans_text_font_selector", "trans_text2_font_selector", "trans_text3_font_selector"
        , "speech_text_system_font", "trans_text_system_font", "trans_text2_system_font", "trans_text3_system_font"
        , "speech_text_direct_font", "trans_text_direct_font", "trans_text2_direct_font", "trans_text3_direct_font"
        , "line_spacing_1", "line_spacing_2", "line_spacing_3"];

    // æ–°ç‰ˆï¼šå…¨è¨­å®šã¯jimakuChan_presetsã§ç®¡ç†ï¼ˆjimakuChan_configã¯å»ƒæ­¢ï¼‰
    // configã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ãƒ—ãƒªã‚»ãƒƒãƒˆä¿å­˜æ™‚ã®ä¸€æ™‚çš„ãªãƒ‡ãƒ¼ã‚¿åé›†ç”¨ã®ã¿
    const config = {};

    // ç¿»è¨³ç”»é¢ã¨URLã‚’åˆæœŸåŒ– ///////////////
    // åˆæœŸèª­ã¿è¾¼ã¿æ™‚ã¯è¨­å®šã‚’åæ˜ ã—ãŸURLã‚’ç”Ÿæˆã—ã¦ã‹ã‚‰èª­ã¿è¾¼ã‚€
    // updateOptionValues(true); // URLç”Ÿæˆã®ã¿ - DOMè¦ç´ ãŒã¾ã å­˜åœ¨ã—ãªã„ãŸã‚ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
    
    // è¨­å®šã‚’å«ã‚€URLã§iframeã‚’èª­ã¿è¾¼ã‚€
    var initial_url = base_url + "textAlign=" + (config.textAlign || "center") + "&v_align=" + (config.v_align || "bottom")
                    + "&bgcolor=" + (config.bgcolor || "#00ff00")
                    + "&size1=" + (config.size1 || "25") + "&weight1=" + (config.weight1 || "900") + "&color1=" + (config.color1 || "#ffffff")
                    + "&st_color1=" + (config.st_color1 || "#000000") + "&st_width1=" + (config.st_width1 || "6")
                    + "&size2=" + (config.size2 || "25") + "&weight2=" + (config.weight2 || "900") + "&color2=" + (config.color2 || "#ffffff")
                    + "&st_color2=" + (config.st_color2 || "#000000") + "&st_width2=" + (config.st_width2 || "6")
                    + "&size3=" + (config.size3 || "25") + "&weight3=" + (config.weight3 || "900") + "&color3=" + (config.color3 || "#ffffff")
                    + "&st_color3=" + (config.st_color3 || "#000000") + "&st_width3=" + (config.st_width3 || "6")
                    + "&size4=" + (config.size4 || "25") + "&weight4=" + (config.weight4 || "900") + "&color4=" + (config.color4 || "#ffffff")
                    + "&st_color4=" + (config.st_color4 || "#000000") + "&st_width4=" + (config.st_width4 || "6");
    
    console.log('åˆæœŸèª­ã¿è¾¼ã¿ URL:', initial_url);
    document.getElementById('asr_frame').src = initial_url;
    // document.getElementById('url').innerHTML = base_url;
    
    // iframeãŒãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸå¾Œã«è¨­å®šã‚’åæ˜ 
    document.getElementById('asr_frame').onload = function() {
        console.log('iframeèª­ã¿è¾¼ã¿å®Œäº†');
        setTimeout(applyInitialSettings, 300);
    };
    // frame_heightã®åˆæœŸåŒ–ã¯ãƒ—ãƒªã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿å¾Œã«è¡Œã†ãŸã‚ã€ã“ã“ã§ã¯å‰Šé™¤
    // applyFrameHeighté–¢æ•°ã§å‡¦ç†ã•ã‚Œã‚‹


    // ãƒ•ã‚©ãƒ³ãƒˆã®ç›´æ¥å…¥åŠ›ã®å ´åˆï¼Œãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æœ‰åŠ¹åŒ–ã€ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’åˆ¶å¾¡ ////////////////////
    function selectFont() {
        var speech_text_font_selector = document.getElementById('speech_text_font_selector').value;
        var trans_text_font_selector = document.getElementById('trans_text_font_selector').value;
        var trans_text2_font_selector = document.getElementById('trans_text2_font_selector').value;
        var trans_text3_font_selector = document.getElementById('trans_text3_font_selector').value;
        
        console.log("ãƒ•ã‚©ãƒ³ãƒˆé¸æŠçŠ¶æ…‹: " + speech_text_font_selector);
        
        // éŸ³å£°èªè­˜ãƒ•ã‚©ãƒ³ãƒˆ
        var speechSystemFont = document.getElementById('speech_text_system_font');
        if (speech_text_font_selector === "direct") {
            if (speechSystemFont) {
                speechSystemFont.disabled = false;
                speechSystemFont.style.backgroundColor = '';
                speechSystemFont.style.color = '';
            }
        } else {
            if (speechSystemFont) {
                speechSystemFont.disabled = true;
                speechSystemFont.style.backgroundColor = '#f0f0f0';
                speechSystemFont.style.color = '#999';
                speechSystemFont.value = ''; // é¸æŠã‚’ã‚¯ãƒªã‚¢
            }
        }

        // ç¿»è¨³1ãƒ•ã‚©ãƒ³ãƒˆ
        var transSystemFont = document.getElementById('trans_text_system_font');
        if (trans_text_font_selector === "direct") {
            if (transSystemFont) {
                transSystemFont.disabled = false;
                transSystemFont.style.backgroundColor = '';
                transSystemFont.style.color = '';
            }
        } else {
            if (transSystemFont) {
                transSystemFont.disabled = true;
                transSystemFont.style.backgroundColor = '#f0f0f0';
                transSystemFont.style.color = '#999';
                transSystemFont.value = '';
            }
        }

        // ç¿»è¨³2ãƒ•ã‚©ãƒ³ãƒˆ
        var trans2SystemFont = document.getElementById('trans_text2_system_font');
        if (trans_text2_font_selector === "direct") {
            if (trans2SystemFont) {
                trans2SystemFont.disabled = false;
                trans2SystemFont.style.backgroundColor = '';
                trans2SystemFont.style.color = '';
            }
        } else {
            if (trans2SystemFont) {
                trans2SystemFont.disabled = true;
                trans2SystemFont.style.backgroundColor = '#f0f0f0';
                trans2SystemFont.style.color = '#999';
                trans2SystemFont.value = '';
            }
        }

        // ç¿»è¨³3ãƒ•ã‚©ãƒ³ãƒˆ
        var trans3SystemFont = document.getElementById('trans_text3_system_font');
        if (trans_text3_font_selector === "direct") {
            if (trans3SystemFont) {
                trans3SystemFont.disabled = false;
                trans3SystemFont.style.backgroundColor = '';
                trans3SystemFont.style.color = '';
            }
        } else {
            if (trans3SystemFont) {
                trans3SystemFont.disabled = true;
                trans3SystemFont.style.backgroundColor = '#f0f0f0';
                trans3SystemFont.style.color = '#999';
                trans3SystemFont.value = '';
            }
        }

        updateOptionValues();
    }
    
    // åˆæœŸè¨­å®šã®åæ˜ 
    selectFont();
    // PCå†…ãƒ•ã‚©ãƒ³ãƒˆã¨ç›´æ¥å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®åˆæœŸçŠ¶æ…‹ã‚’è¨­å®š
    initializeSystemFontFields();
    
    // ãƒ—ãƒªã‚»ãƒƒãƒˆåˆæœŸåŒ–ã¯æœ€ä¸‹éƒ¨ã§å®Ÿè¡Œ

    // åˆæœŸè¨­å®šã‚’é©ç”¨ã™ã‚‹é–¢æ•°
    function applyInitialSettings() {
        try {
            // iframeå†…ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæº–å‚™ã§ãã‚‹ã¾ã§å¾…ã¤
            if (document.getElementById('asr_frame').contentWindow && 
                document.getElementById('asr_frame').contentWindow.document) {
                
                console.log('åˆæœŸè¨­å®šã‚’é©ç”¨ä¸­...');
                
                // ã¾ãšè¨­å®šã‚’URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æ›´æ–°ï¼ˆiframeå†èª­ã¿è¾¼ã¿ï¼‰
                updateOptionValues(false);
                
                // å°‘ã—å¾…ã£ã¦ã‹ã‚‰DOMã®ç›´æ¥æ“ä½œã‚‚å®Ÿè¡Œ
                setTimeout(function() {
                    applyAllSettings();
                    // ã‚¹ãƒ©ã‚¤ãƒ‰ãƒãƒ¼æ•°å€¤è¡¨ç¤ºã‚’æ›´æ–°
                    updateVisualSettings();
                    // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
                    updatePageTitle();
                    console.log('åˆæœŸè¨­å®šé©ç”¨å®Œäº†');
                }, 200);
                
            } else {
                // ã¾ã æº–å‚™ã§ãã¦ã„ãªã„å ´åˆã¯å°‘ã—å¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œ
                setTimeout(applyInitialSettings, 100);
            }
        } catch (error) {
            console.error('åˆæœŸè¨­å®šé©ç”¨ã‚¨ãƒ©ãƒ¼:', error);
            // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã‚‚å†è©¦è¡Œ
            setTimeout(applyInitialSettings, 200);
        }
    }

    // URLã«ä»˜ã‘ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å€¤ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ //////////
    function updateOptionValues(only_url=false) {
        for (const p of config_values) {
            eval("var " + p + " = document.getElementById('" + p + "').value;");
        }
        var bouyomi = document.getElementById('bouyomi').checked;
        var anti_sexual = document.getElementById('anti_sexual').checked;
        
        // ãƒ•ã‚©ãƒ³ãƒˆå¤‰æ•°ã®åˆæœŸåŒ–
        var speech_text_font = '';
        var trans_text_font = '';
        var trans_text2_font = '';
        var trans_text3_font = '';

        var new_url = base_url + "textAlign=" + textAlign + "&v_align=" + v_align 
                     + "&recog=" + recog 
                     + "&bgcolor=" + bgcolor

                     + "&size1=" + size1 + "&weight1=" + weight1 + "&color1=" + color1
                     + "&st_color1=" + st_color1 + "&st_width1=" + st_width1

                     + "&size2=" + size2 + "&weight2=" + weight2 + "&color2=" + color2
                     + "&st_color2=" + st_color2 + "&st_width2=" + st_width2

                     + "&size3=" + size3 + "&weight3=" + weight3 + "&color3=" + color3
                     + "&st_color3=" + st_color3 + "&st_width3=" + st_width3

                     + "&size4=" + size4 + "&weight4=" + weight4 + "&color4=" + color4
                     + "&st_color4=" + st_color4 + "&st_width4=" + st_width4;
        if(whiteSpace != '') {new_url = new_url + "&whiteSpace=" + whiteSpace;} 
        if(trans != 'none') {new_url = new_url + "&trans=" + trans;} 
        if(trans2 != 'none') {new_url = new_url + "&trans2=" + trans2;} 
        if(trans3 != 'none') {new_url = new_url + "&trans3=" + trans3;} 

        // font ã®å‡¦ç†
        console.log('[DEBUG] Font processing:', {
            speech_text_font_selector,
            speech_text_system_font,
            speech_text_direct_font
        });
        if (speech_text_font_selector !== "direct") {
            speech_text_font = speech_text_font_selector;
        } else {
            // ç›´æ¥æŒ‡å®šã®å ´åˆã€ç›´æ¥å…¥åŠ›ã®å€¤ã‚’å„ªå…ˆã€ãªã‘ã‚Œã°ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆã®å€¤ã‚’ä½¿ç”¨
            // ãŸã ã—ã€ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆã®å€¤ãŒ'direct'ã®å ´åˆã¯ç„¡è¦–
            if (speech_text_direct_font && speech_text_direct_font !== '') {
                speech_text_font = speech_text_direct_font;
            } else if (speech_text_system_font && speech_text_system_font !== '' && speech_text_system_font !== 'direct') {
                speech_text_font = speech_text_system_font;
            } else {
                speech_text_font = '';
            }
            console.log('[DEBUG] Direct font selected:', speech_text_font);
        }
        if (trans_text_font_selector !== "direct") {
            trans_text_font = trans_text_font_selector;
        } else {
            if (trans_text_direct_font && trans_text_direct_font !== '') {
                trans_text_font = trans_text_direct_font;
            } else if (trans_text_system_font && trans_text_system_font !== '' && trans_text_system_font !== 'direct') {
                trans_text_font = trans_text_system_font;
            } else {
                trans_text_font = '';
            }
        }
        if (trans_text2_font_selector !== "direct") {
            trans_text2_font = trans_text2_font_selector;
        } else {
            if (trans_text2_direct_font && trans_text2_direct_font !== '') {
                trans_text2_font = trans_text2_direct_font;
            } else if (trans_text2_system_font && trans_text2_system_font !== '' && trans_text2_system_font !== 'direct') {
                trans_text2_font = trans_text2_system_font;
            } else {
                trans_text2_font = '';
            }
        }
        if (trans_text3_font_selector !== "direct") {
            trans_text3_font = trans_text3_font_selector;
        } else {
            if (trans_text3_direct_font && trans_text3_direct_font !== '') {
                trans_text3_font = trans_text3_direct_font;
            } else if (trans_text3_system_font && trans_text3_system_font !== '' && trans_text3_system_font !== 'direct') {
                trans_text3_font = trans_text3_system_font;
            } else {
                trans_text3_font = '';
            }
        }
        if(speech_text_font != '') {
            new_url = new_url + "&speech_text_font=" + speech_text_font;
            console.log('[DEBUG] Adding speech_text_font to URL:', speech_text_font);
        } else {
            console.log('[DEBUG] speech_text_font is empty, not adding to URL');
        } 
        if(trans_text_font != '') {new_url = new_url + "&trans_text_font=" + trans_text_font;} 
        if(trans_text2_font != '') {new_url = new_url + "&trans_text2_font=" + trans_text2_font;} 
        if(trans_text3_font != '') {new_url = new_url + "&trans_text3_font=" + trans_text3_font;} 

        if(timer != '') {new_url = new_url + "&timer=" + timer;} 
        if(short_pause != '') {new_url = new_url + "&short_pause=" + short_pause;}
        
        // è¡Œé–“è¨­å®š
        if(line_spacing_1 != '') {new_url = new_url + "&line_spacing_1=" + line_spacing_1;}
        if(line_spacing_2 != '') {new_url = new_url + "&line_spacing_2=" + line_spacing_2;}
        if(line_spacing_3 != '') {new_url = new_url + "&line_spacing_3=" + line_spacing_3;} 

        if(bouyomi == true) {new_url = new_url + "&bouyomi=" + bouyomi;}
        // anti_sexualã¯ã€ãƒã‚§ãƒƒã‚¯ON=å‰Šé™¤ã‚’ã‚„ã‚ã‚‹(false)ã€ãƒã‚§ãƒƒã‚¯OFF=å‰Šé™¤ã™ã‚‹(true)
        if(anti_sexual == true) {
            new_url = new_url + "&anti_sexual=" + "false";
        } else {
            new_url = new_url + "&anti_sexual=" + "true";
        }
        if(gas_key != '') {new_url = new_url + "&gas_key=" + gas_key;}
   
        // config ã®æ›´æ–°
        for (const p of config_values) {
            config[p] = eval(p);
        }
        
        // checkboxè¨­å®šã‚‚configã«è¿½åŠ ï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆä¿å­˜ç”¨ã®ã¿ï¼‰
        config.bouyomi = bouyomi;
        config.anti_sexual = anti_sexual;

        // æ³¨æ„ï¼šjimakuChan_configã¸ã®ä¿å­˜ã¯å»ƒæ­¢ã€‚å…¨ã¦ãƒ—ãƒªã‚»ãƒƒãƒˆã§ç®¡ç†

        // ãƒ—ãƒªã‚»ãƒƒãƒˆã¸ã®è‡ªå‹•ä¿å­˜ï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿ä¸­ã§ãªã‘ã‚Œã°å®Ÿè¡Œï¼‰
        console.log('updateOptionValues - è‡ªå‹•ä¿å­˜ãƒã‚§ãƒƒã‚¯:', 'isLoadingPreset:', isLoadingPreset, 'currentPreset:', currentPreset);
        if (!isLoadingPreset) {
            console.log('è‡ªå‹•ä¿å­˜ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« - 100mså¾Œã«å®Ÿè¡Œ');
            setTimeout(saveCurrentPreset, 100);
        } else {
            console.log('è‡ªå‹•ä¿å­˜ã‚¹ã‚­ãƒƒãƒ— - ãƒ—ãƒªã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿ä¸­');
        }

        // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã®æ›´æ–°
        updatePageTitle();

        // èªè­˜ã¡ã‚ƒã‚“ç”»é¢ã®æ›´æ–° ///////
        if(only_url == false) {
            console.log('iframeæ›´æ–° URL:', new_url);
            document.getElementById('asr_frame').src = new_url;
        }

        // document.getElementById('url').innerHTML = new_url;
        // document.getElementById('open_link').href = new_url;

        return 0;
    }

    // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    function updatePageTitle() {
        try {
            const presetSelect = document.getElementById('presetSelect');
            if (presetSelect && presetSelect.selectedIndex > 0) {
                const selectedText = presetSelect.options[presetSelect.selectedIndex].text;
                document.title = `jimakuChan: éŸ³å£°èªè­˜å­—å¹•ã¡ã‚ƒã‚“ [${selectedText}]`;
            } else {
                document.title = 'jimakuChan: éŸ³å£°èªè­˜å­—å¹•ã¡ã‚ƒã‚“ [CONFIG]';
            }
        } catch (error) {
            console.log('ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
            document.title = 'jimakuChan: éŸ³å£°èªè­˜å­—å¹•ã¡ã‚ƒã‚“ [CONFIG]';
        }
    }

    // åˆæœŸåŒ–æ™‚ã¯é…å»¶å®Ÿè¡Œ
    setTimeout(function() {
        updateOptionValues();
    }, 100);

    // PCã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚©ãƒ³ãƒˆã‚’æ¤œå‡ºã™ã‚‹é–¢æ•°
    function detectSystemFonts() {
        // ã‚ˆãä½¿ã‚ã‚Œã‚‹ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆã®ãƒªã‚¹ãƒˆï¼ˆæ‹¡å¼µç‰ˆï¼‰
        const commonFonts = [
            // æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆ - Windows
            'Yu Gothic', 'Yu Gothic UI', 'Yu Gothic Medium', 'Yu Mincho', 'Meiryo', 'Meiryo UI',
            'MS Gothic', 'MS PGothic', 'MS UI Gothic', 'MS Mincho', 'MS PMincho',
            'BIZ UDGothic', 'BIZ UDPGothic', 'BIZ UDMincho', 'BIZ UDPMincho',
            'UD Digi Kyokasho', 'UD Digi Kyokasho N-R', 'UD Digi Kyokasho NK-R',
            
            // æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆ - Mac
            'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Hiragino Kaku Gothic Pro',
            'Hiragino Mincho ProN', 'Hiragino Mincho Pro', 'Hiragino Maru Gothic ProN',
            'Osaka', 'Osaka-Mono', 'Tsukushi A Round Gothic', 'Tsukushi B Round Gothic',
            'YuKyokasho', 'YuKyokasho Yoko', 'Klee',
            
            // æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆ - å…±é€š/Web
            'Noto Sans JP', 'Noto Sans CJK JP', 'Noto Serif JP', 'Noto Serif CJK JP',
            'Source Han Sans', 'Source Han Serif', 'æºãƒè§’ã‚´ã‚·ãƒƒã‚¯', 'æºãƒæ˜æœ',
            'Sawarabi Gothic', 'Sawarabi Mincho', 'Kosugi', 'Kosugi Maru',
            'M PLUS 1p', 'M PLUS Rounded 1c', 'M PLUS 2',
            
            // è‹±èªãƒ•ã‚©ãƒ³ãƒˆ - åŸºæœ¬
            'Arial', 'Arial Black', 'Arial Narrow', 'Arial Unicode MS',
            'Helvetica', 'Helvetica Neue', 'Times New Roman', 'Georgia',
            'Verdana', 'Tahoma', 'Trebuchet MS', 'Comic Sans MS',
            'Courier', 'Courier New', 'Lucida Console', 'Consolas',
            
            // è‹±èªãƒ•ã‚©ãƒ³ãƒˆ - è¿½åŠ 
            'Calibri', 'Cambria', 'Candara', 'Century', 'Century Gothic',
            'Franklin Gothic', 'Futura', 'Garamond', 'Gill Sans',
            'Impact', 'Lucida Grande', 'Lucida Sans', 'Monaco',
            'Palatino', 'Palatino Linotype', 'Segoe UI', 'Segoe Print',
            
            // ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆ
            'system-ui', '-apple-system', 'BlinkMacSystemFont',
            'SF Pro Display', 'SF Pro Text', 'SF Mono',
            '.AppleSystemUIFont', 'Apple Color Emoji',
            'Segoe UI Emoji', 'Segoe UI Symbol', 'Roboto',
            
            // è¿½åŠ ã®è£…é£¾ãƒ•ã‚©ãƒ³ãƒˆ
            'HGPå‰µè‹±è§’ï½ºï¾ï½¼ï½¯ï½¸UB', 'HGPå‰µè‹±è§’ï¾ï¾Ÿï½¯ï¾Œï¾Ÿä½“', 'HGPæ•™ç§‘æ›¸ä½“', 'HGPï½ºï¾ï½¼ï½¯ï½¸E',
            'HGPï½ºï¾ï½¼ï½¯ï½¸M', 'HGPæ˜æœE', 'HGSå‰µè‹±è§’ï½ºï¾ï½¼ï½¯ï½¸UB', 'HGSå‰µè‹±è§’ï¾ï¾Ÿï½¯ï¾Œï¾Ÿä½“',
            'DFå¹³æˆæ˜æœä½“', 'DFå¹³æˆã‚´ã‚·ãƒƒã‚¯ä½“', 'DFPå¹³æˆæ˜æœä½“', 'DFPå¹³æˆã‚´ã‚·ãƒƒã‚¯ä½“'
        ];

        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        const testString = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789ã‚ã„ã†ãˆãŠã‚«ã‚­ã‚¯ã‚±ã‚³æ¼¢å­—';
        
        // ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚©ãƒ³ãƒˆï¼‰ã®ã‚µã‚¤ã‚ºã‚’æ¸¬å®š
        context.font = '12px monospace';
        const baselineWidth = context.measureText(testString).width;
        
        const availableFonts = [];
        
        for (const font of commonFonts) {
            context.font = `12px "${font}", monospace`;
            const width = context.measureText(testString).width;
            
            // ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã¨å¹…ãŒç•°ãªã‚Œã°ã€ãã®ãƒ•ã‚©ãƒ³ãƒˆãŒåˆ©ç”¨å¯èƒ½
            if (width !== baselineWidth) {
                availableFonts.push(font);
            }
        }
        
        return availableFonts;
    }

    // ãƒ•ã‚©ãƒ³ãƒˆé¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’åˆæœŸåŒ–ã™ã‚‹é–¢æ•°
    function initializeFontSelectors() {
        const availableFonts = detectSystemFonts();
        const fontSelectors = ['speech_text_system_font', 'trans_text_system_font', 'trans_text2_system_font', 'trans_text3_system_font'];
        
        fontSelectors.forEach(selectorId => {
            const selector = document.getElementById(selectorId);
            if (selector) {
                // æ—¢å­˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
                selector.innerHTML = '';
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'é¸æŠã—ã¦ãã ã•ã„';
                selector.appendChild(defaultOption);
                
                // [ç›´æ¥æŒ‡å®š]ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                const directOption = document.createElement('option');
                directOption.value = 'direct';
                directOption.textContent = '[ç›´æ¥æŒ‡å®š]';
                selector.appendChild(directOption);
                
                // æ¤œå‡ºã•ã‚ŒãŸãƒ•ã‚©ãƒ³ãƒˆã‚’è¿½åŠ 
                availableFonts.forEach(font => {
                    const option = document.createElement('option');
                    option.value = font;
                    option.textContent = font;
                    option.style.fontFamily = font;
                    selector.appendChild(option);
                });
            }
        });
        
        // åˆæœŸåŒ–å¾Œã«çŠ¶æ…‹ã‚’æ­£ã—ãè¨­å®š
        setTimeout(selectFont, 100);
    }

    // ãƒ•ã‚©ãƒ³ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    function updateFontStatus(message, color) {
        const statusElement = document.getElementById('font_api_status');
        if (!statusElement) return;
        
        statusElement.innerHTML = message;
        statusElement.style.color = color || '#666';
        console.log('ãƒ•ã‚©ãƒ³ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:', message);
    }
    
    // Font Access APIå¯¾å¿œçŠ¶æ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦è¡¨ç¤ºã™ã‚‹é–¢æ•°
    function checkFontAPIStatus() {
        if ('queryLocalFonts' in window) {
            updateFontStatus('Font Access APIå¯¾å¿œï¼ˆå®Ÿé¨“çš„æ©Ÿèƒ½ï¼‰', '#008000');
            
            // å®Ÿéš›ã«ä½¿ãˆã‚‹ã‹ãƒ†ã‚¹ãƒˆ
            window.queryLocalFonts().then(fonts => {
                updateFontStatus(`Font Access APIå¯¾å¿œï¼ˆ${fonts.length}å€‹ã®ãƒ•ã‚©ãƒ³ãƒˆæ¤œå‡ºï¼‰`, '#008000');
            }).catch(error => {
                updateFontStatus('Font Access APIï¼ˆæ¨©é™ã‚¨ãƒ©ãƒ¼ï¼‰', '#ff6600');
            });
        } else {
            updateFontStatus('é™å®šãƒªã‚¹ãƒˆä½¿ç”¨ä¸­ï¼ˆFont Access APIéå¯¾å¿œï¼‰', '#666');
        }
    }
    
    // ç›´æ¥æŒ‡å®šãƒ•ã‚©ãƒ³ãƒˆã‚’é©ç”¨ã™ã‚‹é–¢æ•°
    // ãƒ•ã‚©ãƒ³ãƒˆãŒå®Ÿéš›ã«å­˜åœ¨ã™ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°
    function checkFontExists(fontName) {
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        const testString = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789ã‚ã„ã†ãˆãŠã‚«ã‚­ã‚¯ã‚±ã‚³æ¼¢å­—';
        
        // ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼ˆç¢ºå®Ÿã«å­˜åœ¨ã™ã‚‹ãƒ•ã‚©ãƒ³ãƒˆï¼‰ã®ã‚µã‚¤ã‚ºã‚’æ¸¬å®š
        context.font = '12px monospace';
        const monoWidth = context.measureText(testString).width;
        
        context.font = '12px sans-serif';
        const sansWidth = context.measureText(testString).width;
        
        // æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚©ãƒ³ãƒˆã§æ¸¬å®š
        context.font = `12px "${fontName}", monospace`;
        const testWidth = context.measureText(testString).width;
        
        // monospaceã¨åŒã˜å¹…ãªã‚‰ã€ãƒ•ã‚©ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãšãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã•ã‚ŒãŸå¯èƒ½æ€§ãŒé«˜ã„
        return testWidth !== monoWidth;
    }

    function applyDirectFont(fontName, targetElement) {
        if (!fontName || !targetElement) return;
        
        try {
            const iframe = document.getElementById('asr_frame');
            if (!iframe || !iframe.contentWindow || !iframe.contentWindow.document) {
                console.log('iframe not ready, font will be applied later');
                updateFontStatus('â³ iframeæº–å‚™ä¸­...', '#ff6600');
                return;
            }
            
            const iframeDoc = iframe.contentWindow.document;
            const element = iframeDoc.getElementById(targetElement);
            
            if (element) {
                // ãƒ•ã‚©ãƒ³ãƒˆåã®å¤§æ–‡å­—å°æ–‡å­—ã‚’èª¿æ•´ï¼ˆKleeãªã©ï¼‰
                if (fontName.toLowerCase() === 'klee') {
                    fontName = 'Klee';
                }
                
                // ãƒ•ã‚©ãƒ³ãƒˆã‚’é©ç”¨
                const fontFamily = `"${fontName}", sans-serif`;
                element.style.fontFamily = fontFamily;
                
                // å­è¦ç´ ã«ã‚‚é©ç”¨ï¼ˆ-bg, -fg, -imbï¼‰
                const bgElement = iframeDoc.getElementById(targetElement + '-bg');
                const fgElement = iframeDoc.getElementById(targetElement + '-fg');
                const imbElement = iframeDoc.getElementById(targetElement + '-imb');
                
                if (bgElement) bgElement.style.fontFamily = fontFamily;
                if (fgElement) fgElement.style.fontFamily = fontFamily;
                if (imbElement) imbElement.style.fontFamily = fontFamily;
                
                console.log(`ç›´æ¥æŒ‡å®šãƒ•ã‚©ãƒ³ãƒˆé©ç”¨: ${fontName} â†’ ${targetElement}`);
                
                // ãƒ•ã‚©ãƒ³ãƒˆãŒå®Ÿéš›ã«å­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                const fontExists = checkFontExists(fontName);
                
                if (fontExists) {
                    // ã•ã‚‰ã«å®Ÿéš›ã«é©ç”¨ã•ã‚ŒãŸã‹ã‚’ç¢ºèª
                    const computedStyle = iframeDoc.defaultView.getComputedStyle(element);
                    const appliedFont = computedStyle.fontFamily;
                    
                    if (appliedFont.includes(fontName)) {
                        updateFontStatus(`âœ… ç›´æ¥æŒ‡å®š: ${fontName}`, '#008000');
                    } else {
                        updateFontStatus(`âš ï¸ ç›´æ¥æŒ‡å®š: ${fontName} (éƒ¨åˆ†çš„ã«é©ç”¨)`, '#ff6600');
                    }
                } else {
                    updateFontStatus(`âŒ ãƒ•ã‚©ãƒ³ãƒˆãªã—ã‚¨ãƒ©ãƒ¼ ç›´æ¥æŒ‡å®š: ${fontName}`, '#cc0000');
                }
            }
        } catch (error) {
            console.log('ç›´æ¥æŒ‡å®šãƒ•ã‚©ãƒ³ãƒˆé©ç”¨ã‚¨ãƒ©ãƒ¼:', error);
            updateFontStatus(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, '#cc0000');
        }
    }
    
    // ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆã‚’é©ç”¨ã™ã‚‹é–¢æ•°
    function applySystemFont(fontName, targetElement) {
        // å¯¾å¿œã™ã‚‹ç›´æ¥å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å–å¾—
        const directFontInput = document.getElementById(targetElement + '_direct_font');
        
        if (fontName === 'direct') {
            // [ç›´æ¥æŒ‡å®š]ãŒé¸ã°ã‚ŒãŸå ´åˆã€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æœ‰åŠ¹åŒ–
            if (directFontInput) {
                directFontInput.disabled = false;
                directFontInput.style.backgroundColor = '';
                directFontInput.style.color = '';
                directFontInput.focus();
            }
        } else {
            // ãã‚Œä»¥å¤–ã®å ´åˆã€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç„¡åŠ¹åŒ–ã—ã¦ã‚¯ãƒªã‚¢
            if (directFontInput) {
                directFontInput.disabled = true;
                directFontInput.style.backgroundColor = '#f0f0f0';
                directFontInput.style.color = '#999';
                directFontInput.value = '';
            }
            
            // é¸æŠã•ã‚ŒãŸãƒ•ã‚©ãƒ³ãƒˆã‚’é©ç”¨
            if (fontName && fontName !== '') {
                try {
                    const iframe = document.getElementById('asr_frame');
                    if (!iframe || !iframe.contentWindow || !iframe.contentWindow.document) {
                        console.log('iframe not ready, font will be applied later');
                        return;
                    }
                    
                    const iframeDoc = iframe.contentWindow.document;
                    const element = iframeDoc.getElementById(targetElement);
                    if (element) {
                        // ãƒ•ã‚©ãƒ³ãƒˆåã®å¤§æ–‡å­—å°æ–‡å­—ã‚’èª¿æ•´ï¼ˆKleeãªã©ï¼‰
                        if (fontName.toLowerCase() === 'klee') {
                            fontName = 'Klee';
                        }
                        
                        const fontFamily = `"${fontName}", sans-serif`;
                        element.style.fontFamily = fontFamily;
                        
                        // å­è¦ç´ ã«ã‚‚é©ç”¨ï¼ˆ-bg, -fg, -imbï¼‰
                        const bgElement = iframeDoc.getElementById(targetElement + '-bg');
                        const fgElement = iframeDoc.getElementById(targetElement + '-fg');
                        const imbElement = iframeDoc.getElementById(targetElement + '-imb');
                        
                        if (bgElement) bgElement.style.fontFamily = fontFamily;
                        if (fgElement) fgElement.style.fontFamily = fontFamily;
                        if (imbElement) imbElement.style.fontFamily = fontFamily;
                        
                        console.log(`ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆé©ç”¨: ${fontName} â†’ ${targetElement}`);
                        
                        // ãƒ•ã‚©ãƒ³ãƒˆãŒå®Ÿéš›ã«é©ç”¨ã•ã‚ŒãŸã‹ãƒã‚§ãƒƒã‚¯
                        const computedStyle = iframe.contentWindow.document.defaultView.getComputedStyle(element);
                        const appliedFont = computedStyle.fontFamily;
                        
                        if (appliedFont.includes(fontName)) {
                            updateFontStatus(`âœ… PCå†…ãƒ•ã‚©ãƒ³ãƒˆ: ${fontName}`, '#008000');
                        } else {
                            updateFontStatus(`âš ï¸ PCå†…ãƒ•ã‚©ãƒ³ãƒˆ: ${fontName} (æœªæ¤œå‡º)`, '#ff6600');
                        }
                    }
                } catch (error) {
                    console.log('ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆé©ç”¨ã‚¨ãƒ©ãƒ¼:', error);
                }
            }
        }
    }

    // PCå†…ãƒ•ã‚©ãƒ³ãƒˆã¨ç›´æ¥å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®çŠ¶æ…‹ã‚’åˆæœŸåŒ–ã™ã‚‹é–¢æ•°
    function initializeSystemFontFields() {
        const fontTargets = ['speech_text', 'trans_text', 'trans_text2', 'trans_text3'];
        
        fontTargets.forEach(target => {
            const systemFontSelect = document.getElementById(target + '_system_font');
            const directFontInput = document.getElementById(target + '_direct_font');
            
            if (systemFontSelect && directFontInput) {
                // ä¿å­˜ã•ã‚ŒãŸå€¤ãŒã‚ã‚‹å ´åˆã¯å¾©å…ƒ
                const savedSystemFont = systemFontSelect.value;
                const savedDirectFont = directFontInput.value;
                
                // ç›´æ¥å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®çŠ¶æ…‹ã‚’è¨­å®š
                if (savedSystemFont === 'direct') {
                    // [ç›´æ¥æŒ‡å®š]ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ãƒ•ã‚©ãƒ³ãƒˆåãŒç©ºã§ã‚‚æœ‰åŠ¹åŒ–
                    directFontInput.disabled = false;
                    directFontInput.style.backgroundColor = '';
                    directFontInput.style.color = '';
                    // ç›´æ¥å…¥åŠ›ã•ã‚ŒãŸãƒ•ã‚©ãƒ³ãƒˆãŒã‚ã‚‹å ´åˆã®ã¿é©ç”¨
                    if (savedDirectFont) {
                        applyDirectFont(savedDirectFont, target);
                    }
                } else {
                    directFontInput.disabled = true;
                    directFontInput.style.backgroundColor = '#f0f0f0';
                    directFontInput.style.color = '#999';
                    // ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆã‚’é©ç”¨
                    if (savedSystemFont && savedSystemFont !== '' && savedSystemFont !== 'direct') {
                        applySystemFont(savedSystemFont, target);
                    }
                }
            }
        });
    }
    
    // è¡Œé–“ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–°ã™ã‚‹é–¢æ•°
    function updateLineSpacing(targetElement, spacing) {
        try {
            const iframe = document.getElementById('asr_frame');
            if (!iframe || !iframe.contentWindow || !iframe.contentWindow.document) {
                console.log('iframe not ready for line spacing update');
                return;
            }
            
            const element = iframe.contentWindow.document.getElementById(targetElement);
            if (element) {
                element.style.marginBottom = spacing + 'px';
                console.log(`è¡Œé–“æ›´æ–°: ${targetElement} â†’ ${spacing}px`);
            }
        } catch (error) {
            console.log('è¡Œé–“æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
        }
    }
    
    // é¸æŠã•ã‚ŒãŸãƒ•ã‚©ãƒ³ãƒˆã‚’é©ç”¨ã™ã‚‹é–¢æ•°
    function applySelectedFont(selector, targetElement) {
        try {
            const iframe = document.getElementById('asr_frame');
            if (!iframe || !iframe.contentWindow || !iframe.contentWindow.document) {
                console.log('iframe not ready, font will be applied later');
                return;
            }
            
            let fontValue = selector.value;
            
            // "direct"ã®å ´åˆã¯ä½•ã‚‚ã—ãªã„ï¼ˆã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆé¸æŠã§å‡¦ç†ï¼‰
            if (fontValue === 'direct') {
                return;
            }
            
            // directã§ãªã„å ´åˆã€ç›´æ¥å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
            const directFontInput = document.getElementById(targetElement + '_direct_font');
            if (directFontInput) {
                directFontInput.value = '';
            }
            
            // ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚’é™¤å»ã—ã¦ãƒ•ã‚©ãƒ³ãƒˆåã‚’æ­£è¦åŒ–
            fontValue = fontValue.replace(/\\\\/g, '');
            
            const iframeDoc = iframe.contentWindow.document;
            const element = iframeDoc.getElementById(targetElement);
            if (element) {
                const fontFamily = `"${fontValue}", sans-serif`;
                element.style.fontFamily = fontFamily;
                
                // å­è¦ç´ ã«ã‚‚é©ç”¨ï¼ˆ-bg, -fg, -imbï¼‰
                const bgElement = iframeDoc.getElementById(targetElement + '-bg');
                const fgElement = iframeDoc.getElementById(targetElement + '-fg');
                const imbElement = iframeDoc.getElementById(targetElement + '-imb');
                
                if (bgElement) bgElement.style.fontFamily = fontFamily;
                if (fgElement) fgElement.style.fontFamily = fontFamily;
                if (imbElement) imbElement.style.fontFamily = fontFamily;
                
                console.log(`ãƒ•ã‚©ãƒ³ãƒˆé©ç”¨: ${fontValue} â†’ ${targetElement}`);
                updateFontStatus(`âœ… ãƒ•ã‚©ãƒ³ãƒˆ: ${fontValue}`, '#008000');
            }
        } catch (error) {
            console.log('ãƒ•ã‚©ãƒ³ãƒˆé©ç”¨ã‚¨ãƒ©ãƒ¼:', error);
        }
    }

    // ãƒ†ã‚­ã‚¹ãƒˆã®è‰²å¤‰ãˆ ---------------------------
    function changeTextColor(type, color, id) {
        try {
            var iframe = document.getElementById('asr_frame');
            if (!iframe || !iframe.contentWindow || !iframe.contentWindow.document) {
                return;
            }
            
            var text_layer = ['fg','bg','imb'];
            var lang_line = ['speech_text','trans_text','trans_text2','trans_text3'];
            var element = iframe.contentWindow.document.getElementById(lang_line[id-1] + '-' + type);

            if (element) {
                if(type == "fg") { 
                    element.style.color = color;
                } else { 
                    element.style.webkitTextStrokeColor = color; 
                }
            }

            // type ãŒ imb ã®å ´åˆã¯ï¼Œå…¨ã¦ã®lang_lineã«åæ˜ 
            if(type == "imb") {
                for (const ll of lang_line){
                    var imbElement = iframe.contentWindow.document.getElementById(ll + '-' + type);
                    if (imbElement) {
                        imbElement.style.webkitTextStrokeColor = color;
                        imbElement.style.color = color;
                    }
                } 
            }
        } catch (error) {
            console.error('è‰²å¤‰æ›´ã‚¨ãƒ©ãƒ¼:', error);
        }
    }

    function setTextBorder(width, id) {
        try {
            var iframe = document.getElementById('asr_frame');
            if (!iframe || !iframe.contentWindow || !iframe.contentWindow.document) {
                return;
            }
            
            var lang_line = ['speech_text','trans_text','trans_text2','trans_text3'];
            var bgElement = iframe.contentWindow.document.getElementById(lang_line[id-1] + "-bg");
            var imbElement = iframe.contentWindow.document.getElementById(lang_line[id-1] + "-imb");

            if (bgElement) {
                bgElement.style.webkitTextStrokeWidth = width + 'pt';
            }
            if (imbElement) {
                imbElement.style.webkitTextStrokeWidth = width + 'pt';
            }
        } catch (error) {
            console.error('ãƒœãƒ¼ãƒ€ãƒ¼è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
        }
   }

    function changeText(text, id){
        var text_layer = ['fg','bg','imb'];
        var lang_line = ['speech_text','trans_text','trans_text2','trans_text3'];

        for (const tl of text_layer){ 
            document.getElementById('asr_frame').contentWindow.document.getElementById(ll[id-1] + '-' + tl).innerHTML = text;
        }         
    }
    
    // å…¨ã¦ã®è¨­å®šã‚’é©ç”¨ã™ã‚‹é–¢æ•°
    function applyAllSettings() {
        try {
            var iframe = document.getElementById('asr_frame');
            if (!iframe || !iframe.contentWindow || !iframe.contentWindow.document) {
                console.log('iframeæœªæº–å‚™ã®ãŸã‚è¨­å®šé©ç”¨ã‚’ã‚¹ã‚­ãƒƒãƒ—');
                return false;
            }
            
            var iframeDoc = iframe.contentWindow.document;
            
            // èƒŒæ™¯è‰²
            var bgcolor = document.getElementById('bgcolor').value;
            if (bgcolor) {
                iframeDoc.bgColor = bgcolor;
            }
            
            // ãƒ†ã‚­ã‚¹ãƒˆã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ
            var v_align = document.getElementById('v_align').value;
            var textTable = iframeDoc.getElementById("text_table");
            if (textTable) {
                if (v_align == "top"){
                    textTable.style.bottom = -1;
                } else if(v_align == "bottom"){
                    textTable.style.bottom = 0;
                }
            }
            
            var textAlign = document.getElementById('textAlign').value;
            if (textTable && textAlign) {
                textTable.style.textAlign = textAlign;
                var tblTd = iframeDoc.getElementById("tbl_td");
                if (tblTd) {
                    tblTd.style.textAlign = textAlign;
                    if(textAlign == "right"){
                        textTable.style.direction = "rtl";
                        tblTd.style.direction = "rtl";
                        iframeDoc.body.style.direction = "rtl";
                    }
                }
            }
            
            // å„ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è‰²ã¨ã‚µã‚¤ã‚ºã‚’æ›´æ–°
            for (var i = 1; i <= 4; i++) {
                changeTextColor('fg', document.getElementById('color' + i).value, i);
                changeTextColor('bg', document.getElementById('st_color' + i).value, i);
                setTextBorder(document.getElementById('st_width' + i).value, i);
                
                var lang_line = ['speech_text','trans_text','trans_text2','trans_text3'];
                var textElement = iframeDoc.getElementById(lang_line[i-1]);
                if (textElement) {
                    textElement.style.fontSize = document.getElementById('size' + i).value + 'pt';
                    textElement.style.fontWeight = document.getElementById('weight' + i).value;
                    
                    // ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š
                    var fontSelectorIds = ['speech_text_font_selector', 'trans_text_font_selector', 'trans_text2_font_selector', 'trans_text3_font_selector'];
                    var systemFontIds = ['speech_text_system_font', 'trans_text_system_font', 'trans_text2_system_font', 'trans_text3_system_font'];
                    
                    var fontSelector = document.getElementById(fontSelectorIds[i-1]);
                    var systemFontSelector = document.getElementById(systemFontIds[i-1]);
                    
                    if (fontSelector) {
                        if (fontSelector.value === 'direct' && systemFontSelector && systemFontSelector.value) {
                            // ç›´æ¥æŒ‡å®š + ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆé¸æŠã®å ´åˆ
                            textElement.style.fontFamily = `"${systemFontSelector.value}", sans-serif`;
                            console.log('ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š:', lang_line[i-1], systemFontSelector.value);
                        } else if (fontSelector.value !== 'direct' && fontSelector.value !== '') {
                            // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ•ã‚©ãƒ³ãƒˆé¸æŠã®å ´åˆ
                            var fontValue = fontSelector.value.replace(/\\\\/g, '');  // ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚’é™¤å»
                            textElement.style.fontFamily = `"${fontValue}", sans-serif`;
                            console.log('ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ•ã‚©ãƒ³ãƒˆè¨­å®š:', lang_line[i-1], fontValue);
                        }
                    }
                }
            }
            
            // èƒŒæ™¯è‰²ã‚’å…¨ã¦ã®imbè¦ç´ ã«é©ç”¨
            changeTextColor('imb', bgcolor, 1);
            
            // æ”¹è¡Œè¨­å®š
            var whiteSpace = document.getElementById('whiteSpace').value;
            if (textTable && whiteSpace) {
                textTable.style.whiteSpace = whiteSpace;
            }
            
            
            // ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
            selectFont();
            
            return true;
        } catch (error) {
            console.error('è¨­å®šé©ç”¨ä¸­ã«ã‚¨ãƒ©ãƒ¼:', error);
            return false;
        }
    }

</script>

<!-- # ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆç”¨ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ############################## -->
<script>  
    function generateFile(content, fileName) {
      const blob = new Blob([content], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = window.URL.createObjectURL(blob);
      link.download = fileName;
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  
    function generateBatFile(os) {
    //   let url = document.getElementById('url').value.trim();
        let url = currentURL;
      // URLãƒ‡ã‚³ãƒ¼ãƒ‰ã‚’è¡Œã†
      url = decodeURIComponent(url);
  
      if (url === '') {
        alert('URLãŒã‚ã‚Šã¾ã›ã‚“ï¼ã‚¨ãƒ©ãƒ¼ã§ã™ï¼');
        return;
      }
      
      let content, filename;
  
      if (os === 'win') {
        content = `@echo off\r\nset "USERPROFILE=%LOCALAPPDATA%\\Google\\Chrome\\User Data\\user_jimaku_001"\r\nstart chrome.exe --disable-features=CalculateNativeWinOcclusion --user-data-dir="%USERPROFILE%" --new-window "${url}"\r\nexit /b`;
        filename = "jimakuChan_nonStop.bat";

      } else {
        content = `#!/bin/sh\n"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome" --disable-features=CalculateNativeWinOcclusion --user-data-dir="Library/Application Support/Google/Chrome/user_jimaku_001"  --new-window "${url}"`;
        filename = "jimakuChan_nonStop.command";
      }
  
      generateFile(content, filename);
    }

</script>

<!-- # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ã¨èª­è¾¼ ############################## -->
<script>

    // Save all presets to a file (å…¨ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜)
    function saveSettings() {
        const presets = localStorage.getItem('jimakuChan_presets');
        if (!presets) {
            alert('ä¿å­˜ã™ã‚‹ãƒ—ãƒªã‚»ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼');
            return;
        }
        
        try {
            const presetsData = JSON.parse(presets);
            const exportData = {
                version: "2025.7.6 14:45",
                exportDate: new Date().toISOString(),
                presets: presetsData
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'jimakuChan_presets.json';
            link.click();
            URL.revokeObjectURL(link.href);
            console.log('ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ');
        } catch (error) {
            alert('ãƒ—ãƒªã‚»ãƒƒãƒˆä¿å­˜ã‚¨ãƒ©ãƒ¼: ' + error.message);
            console.error('ãƒ—ãƒªã‚»ãƒƒãƒˆä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        }
    }

    // Load presets from a file (ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿)
    function loadSettings() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = e => {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(readEvent) {
                try {
                    const data = JSON.parse(readEvent.target.result);
                    console.log('èª­ã¿è¾¼ã‚“ã ãƒ•ã‚¡ã‚¤ãƒ«:', data);
                    
                    // æ–°å½¢å¼ã®ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ
                    if (data.presets && data.version) {
                        console.log('æ–°å½¢å¼ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿');
                        localStorage.setItem('jimakuChan_presets', JSON.stringify(data.presets));
                        alert(`ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ (ver.${data.version})`);
                        location.reload();
                    }
                    // æ—§å½¢å¼ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆï¼ˆäº’æ›æ€§ã®ãŸã‚ï¼‰
                    else if (data && typeof data === 'object' && !data.presets) {
                        console.log('æ—§å½¢å¼è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ - ãƒ—ãƒªã‚»ãƒƒãƒˆã«å¤‰æ›');
                        const convertedPreset = {
                            default: {
                                name: 'èª­ã¿è¾¼ã‚“ã è¨­å®š',
                                settings: data,
                                lastModified: new Date().toISOString(),
                                importedFrom: 'legacy_file'
                            }
                        };
                        localStorage.setItem('jimakuChan_presets', JSON.stringify(convertedPreset));
                        alert('æ—§å½¢å¼ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒªã‚»ãƒƒãƒˆã«å¤‰æ›ã—ã¦èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
                        location.reload();
                    }
                    else {
                        alert('ä¸æ­£ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™');
                    }
                } catch (error) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ' + error.message);
                    console.error('ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                }
            };
            reader.readAsText(file);
        };
        input.click();
    }

</script>

<!-- # è¨­å®šãƒ—ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ã€€############################ -->
<script>
    // ãƒ—ãƒªã‚»ãƒƒãƒˆã®å®šç¾©ï¼ˆå¯æ„›ã„é…è‰²ã§æ”¹å–„ï¼‰
    const defaultPresets = {
        default: {
            name: "ğŸ“‹ é¸æŠã—ã¦ãã ã•ã„",
            settings: {
                gas_key: "",
                textAlign: "center",
                v_align: "bottom",
                whiteSpace: "",
                bgcolor: "#00ff00",
                recog: "ja",
                size1: "25",
                weight1: "900",
                color1: "#ffffff",
                st_color1: "#000000",
                st_width1: "6",
                trans: "en",
                size2: "25",
                weight2: "900",
                color2: "#ffffff",
                st_color2: "#000000",
                st_width2: "6",
                trans2: "none",
                size3: "25",
                weight3: "900",
                color3: "#ffffff",
                st_color3: "#000000",
                st_width3: "6",
                trans3: "none",
                size4: "25",
                weight4: "900",
                color4: "#ffffff",
                st_color4: "#000000",
                st_width4: "6",
                timer: "7000",
                short_pause: "750",
                bouyomi: false,
                anti_sexual: false,
                speech_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text2_font_selector: "M PLUS Rounded\\ 1c",
                trans_text3_font_selector: "M PLUS Rounded\\ 1c",
                speech_text_system_font: "",
                trans_text_system_font: "",
                trans_text2_system_font: "",
                trans_text3_system_font: ""
            }
        },
        gaming: {
            name: "ğŸ® ã‚²ãƒ¼ãƒ é…ä¿¡ç”¨",
            settings: {
                gas_key: "",
                textAlign: "center",
                v_align: "bottom",
                whiteSpace: "",
                bgcolor: "#00ff00",
                recog: "ja",
                size1: "28",
                weight1: "900",
                color1: "#ffffff",
                st_color1: "#ff6b9d",
                st_width1: "6",
                trans: "en",
                size2: "24",
                weight2: "900",
                color2: "#ffeb3b",
                st_color2: "#7b1fa2",
                st_width2: "4",
                trans2: "none",
                size3: "25",
                weight3: "900",
                color3: "#ffffff",
                st_color3: "#000000",
                st_width3: "6",
                trans3: "none",
                size4: "25",
                weight4: "900",
                color4: "#ffffff",
                st_color4: "#000000",
                st_width4: "6",
                timer: "5000",
                short_pause: "1000",
                bouyomi: false,
                anti_sexual: false,
                speech_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text2_font_selector: "M PLUS Rounded\\ 1c",
                trans_text3_font_selector: "M PLUS Rounded\\ 1c",
                speech_text_system_font: "",
                trans_text_system_font: "",
                trans_text2_system_font: "",
                trans_text3_system_font: ""
            }
        },
        meeting: {
            name: "ğŸ’¼ ä¼šè­°ãƒ»æ‰“ã¡åˆã‚ã›ç”¨",
            settings: {
                gas_key: "",
                textAlign: "left",
                v_align: "top",
                whiteSpace: "",
                bgcolor: "#00ff00",
                recog: "ja",
                size1: "22",
                weight1: "500",
                color1: "#2e3440",
                st_color1: "#eceff4",
                st_width1: "3",
                trans: "en",
                size2: "20",
                weight2: "500",
                color2: "#5e81ac",
                st_color2: "#eceff4",
                st_width2: "2",
                trans2: "none",
                size3: "25",
                weight3: "900",
                color3: "#ffffff",
                st_color3: "#000000",
                st_width3: "6",
                trans3: "none",
                size4: "25",
                weight4: "900",
                color4: "#ffffff",
                st_color4: "#000000",
                st_width4: "6",
                timer: "10000",
                short_pause: "750",
                bouyomi: false,
                anti_sexual: false,
                speech_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text2_font_selector: "M PLUS Rounded\\ 1c",
                trans_text3_font_selector: "M PLUS Rounded\\ 1c",
                speech_text_system_font: "",
                trans_text_system_font: "",
                trans_text2_system_font: "",
                trans_text3_system_font: ""
            }
        },
        language_learning: {
            name: "ğŸ“š èªå­¦å­¦ç¿’ç”¨",
            settings: {
                gas_key: "",
                textAlign: "center",
                v_align: "center",
                whiteSpace: "",
                bgcolor: "#00ff00",
                recog: "ja",
                size1: "26",
                weight1: "600",
                color1: "#2d3748",
                st_color1: "#bee3f8",
                st_width1: "4",
                trans: "en",
                size2: "22",
                weight2: "600",
                color2: "#d53f8c",
                st_color2: "#fed7e2",
                st_width2: "3",
                trans2: "none",
                size3: "22",
                weight3: "600",
                color3: "#3182ce",
                st_color3: "#bee3f8",
                st_width3: "3",
                trans3: "none",
                size4: "25",
                weight4: "900",
                color4: "#ffffff",
                st_color4: "#000000",
                st_width4: "6",
                timer: "15000",
                short_pause: "500",
                bouyomi: false,
                anti_sexual: false,
                speech_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text2_font_selector: "M PLUS Rounded\\ 1c",
                trans_text3_font_selector: "M PLUS Rounded\\ 1c",
                speech_text_system_font: "",
                trans_text_system_font: "",
                trans_text2_system_font: "",
                trans_text3_system_font: ""
            }
        },
        accessibility: {
            name: "â™¿ ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£é‡è¦–",
            settings: {
                gas_key: "",
                textAlign: "center",
                v_align: "bottom",
                whiteSpace: "",
                bgcolor: "#00ff00",
                recog: "ja",
                size1: "32",
                weight1: "900",
                color1: "#ffffff",
                st_color1: "#000000",
                st_width1: "8",
                trans: "en",
                size2: "25",
                weight2: "900",
                color2: "#ffffff",
                st_color2: "#000000",
                st_width2: "6",
                trans2: "none",
                size3: "25",
                weight3: "900",
                color3: "#ffffff",
                st_color3: "#000000",
                st_width3: "6",
                trans3: "none",
                size4: "25",
                weight4: "900",
                color4: "#ffffff",
                st_color4: "#000000",
                st_width4: "6",
                timer: "7000",
                short_pause: "1500",
                bouyomi: false,
                anti_sexual: false,
                speech_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text2_font_selector: "M PLUS Rounded\\ 1c",
                trans_text3_font_selector: "M PLUS Rounded\\ 1c",
                speech_text_system_font: "",
                trans_text_system_font: "",
                trans_text2_system_font: "",
                trans_text3_system_font: ""
            }
        },
        cute_streaming: {
            name: "ğŸŒ¸ ã‹ã‚ã„ã„é…ä¿¡ç”¨",
            settings: {
                gas_key: "",
                textAlign: "center",
                v_align: "bottom",
                whiteSpace: "",
                bgcolor: "#00ff00",
                recog: "ja",
                size1: "30",
                weight1: "700",
                color1: "#ffffff",
                st_color1: "#ff69b4",
                st_width1: "5",
                trans: "en",
                size2: "26",
                weight2: "700",
                color2: "#ff1493",
                st_color2: "#ffb6c1",
                st_width2: "4",
                trans2: "none",
                size3: "25",
                weight3: "900",
                color3: "#ffffff",
                st_color3: "#000000",
                st_width3: "6",
                trans3: "none",
                size4: "25",
                weight4: "900",
                color4: "#ffffff",
                st_color4: "#000000",
                st_width4: "6",
                timer: "6000",
                short_pause: "800",
                bouyomi: false,
                anti_sexual: false,
                speech_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text2_font_selector: "M PLUS Rounded\\ 1c",
                trans_text3_font_selector: "M PLUS Rounded\\ 1c",
                speech_text_system_font: "",
                trans_text_system_font: "",
                trans_text2_system_font: "",
                trans_text3_system_font: ""
            }
        },
        dark_theme: {
            name: "ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ",
            settings: {
                gas_key: "",
                textAlign: "center",
                v_align: "bottom",
                whiteSpace: "",
                bgcolor: "#00ff00",
                recog: "ja",
                size1: "27",
                weight1: "600",
                color1: "#e2e8f0",
                st_color1: "#4a5568",
                st_width1: "4",
                trans: "en",
                size2: "23",
                weight2: "600",
                color2: "#81e6d9",
                st_color2: "#2d3748",
                st_width2: "3",
                trans2: "none",
                size3: "25",
                weight3: "900",
                color3: "#ffffff",
                st_color3: "#000000",
                st_width3: "6",
                trans3: "none",
                size4: "25",
                weight4: "900",
                color4: "#ffffff",
                st_color4: "#000000",
                st_width4: "6",
                timer: "7000",
                short_pause: "900",
                bouyomi: false,
                anti_sexual: false,
                speech_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text2_font_selector: "M PLUS Rounded\\ 1c",
                trans_text3_font_selector: "M PLUS Rounded\\ 1c",
                speech_text_system_font: "",
                trans_text_system_font: "",
                trans_text2_system_font: "",
                trans_text3_system_font: ""
            }
        },
        rainbow: {
            name: "ğŸŒˆ ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼",
            settings: {
                gas_key: "",
                textAlign: "center",
                v_align: "bottom",
                whiteSpace: "",
                bgcolor: "#00ff00",
                recog: "ja",
                size1: "29",
                weight1: "800",
                color1: "#ffffff",
                st_color1: "#ff0080",
                st_width1: "6",
                trans: "en",
                size2: "25",
                weight2: "800",
                color2: "#00ff80",
                st_color2: "#ff8000",
                st_width2: "5",
                trans2: "none",
                size3: "25",
                weight3: "800",
                color3: "#8080ff",
                st_color3: "#ff0080",
                st_width3: "5",
                trans3: "none",
                size4: "25",
                weight4: "900",
                color4: "#ffffff",
                st_color4: "#000000",
                st_width4: "6",
                timer: "5500",
                short_pause: "750",
                bouyomi: false,
                anti_sexual: false,
                speech_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text2_font_selector: "M PLUS Rounded\\ 1c",
                trans_text3_font_selector: "M PLUS Rounded\\ 1c",
                speech_text_system_font: "",
                trans_text_system_font: "",
                trans_text2_system_font: "",
                trans_text3_system_font: ""
            }
        },
        custom1: {
            name: "ğŸ”§ ã‚«ã‚¹ã‚¿ãƒ ï¼‘",
            settings: {
                gas_key: "",
                textAlign: "center",
                v_align: "bottom",
                whiteSpace: "",
                bgcolor: "#00ff00",
                recog: "ja",
                size1: "25",
                weight1: "900",
                color1: "#ffffff",
                st_color1: "#000000",
                st_width1: "6",
                trans: "en",
                size2: "25",
                weight2: "900",
                color2: "#ffffff",
                st_color2: "#000000",
                st_width2: "6",
                trans2: "none",
                size3: "25",
                weight3: "900",
                color3: "#ffffff",
                st_color3: "#000000",
                st_width3: "6",
                trans3: "none",
                size4: "25",
                weight4: "900",
                color4: "#ffffff",
                st_color4: "#000000",
                st_width4: "6",
                timer: "7000",
                short_pause: "750",
                bouyomi: false,
                anti_sexual: false,
                speech_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text2_font_selector: "M PLUS Rounded\\ 1c",
                trans_text3_font_selector: "M PLUS Rounded\\ 1c",
                speech_text_system_font: "",
                trans_text_system_font: "",
                trans_text2_system_font: "",
                trans_text3_system_font: ""
            }
        },
        custom2: {
            name: "ğŸ”§ ã‚«ã‚¹ã‚¿ãƒ ï¼’",
            settings: {
                gas_key: "",
                textAlign: "center",
                v_align: "bottom",
                whiteSpace: "",
                bgcolor: "#00ff00",
                recog: "ja",
                size1: "25",
                weight1: "900",
                color1: "#ffffff",
                st_color1: "#000000",
                st_width1: "6",
                trans: "en",
                size2: "25",
                weight2: "900",
                color2: "#ffffff",
                st_color2: "#000000",
                st_width2: "6",
                trans2: "none",
                size3: "25",
                weight3: "900",
                color3: "#ffffff",
                st_color3: "#000000",
                st_width3: "6",
                trans3: "none",
                size4: "25",
                weight4: "900",
                color4: "#ffffff",
                st_color4: "#000000",
                st_width4: "6",
                timer: "7000",
                short_pause: "750",
                bouyomi: false,
                anti_sexual: false,
                speech_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text2_font_selector: "M PLUS Rounded\\ 1c",
                trans_text3_font_selector: "M PLUS Rounded\\ 1c",
                speech_text_system_font: "",
                trans_text_system_font: "",
                trans_text2_system_font: "",
                trans_text3_system_font: ""
            }
        },
        custom3: {
            name: "ğŸ”§ ã‚«ã‚¹ã‚¿ãƒ ï¼“",
            settings: {
                gas_key: "",
                textAlign: "center",
                v_align: "bottom",
                whiteSpace: "",
                bgcolor: "#00ff00",
                recog: "ja",
                size1: "25",
                weight1: "900",
                color1: "#ffffff",
                st_color1: "#000000",
                st_width1: "6",
                trans: "en",
                size2: "25",
                weight2: "900",
                color2: "#ffffff",
                st_color2: "#000000",
                st_width2: "6",
                trans2: "none",
                size3: "25",
                weight3: "900",
                color3: "#ffffff",
                st_color3: "#000000",
                st_width3: "6",
                trans3: "none",
                size4: "25",
                weight4: "900",
                color4: "#ffffff",
                st_color4: "#000000",
                st_width4: "6",
                timer: "7000",
                short_pause: "750",
                bouyomi: false,
                anti_sexual: false,
                speech_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text_font_selector: "M PLUS Rounded\\ 1c",
                trans_text2_font_selector: "M PLUS Rounded\\ 1c",
                trans_text3_font_selector: "M PLUS Rounded\\ 1c",
                speech_text_system_font: "",
                trans_text_system_font: "",
                trans_text2_system_font: "",
                trans_text3_system_font: ""
            }
        }
    };

    // ç¾åœ¨é¸æŠä¸­ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä¿å­˜ï¼ˆåˆæœŸåŒ–é–¢æ•°å†…ã§è¨­å®šï¼‰
    let currentPreset = 'default';
    
    // ãƒ—ãƒªã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿ä¸­ãƒ•ãƒ©ã‚°ï¼ˆè‡ªå‹•ä¿å­˜ã‚’ä¸€æ™‚åœæ­¢ã™ã‚‹ãŸã‚ï¼‰
    let isLoadingPreset = false;
    
    // ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’èª­ã¿è¾¼ã‚€
    function loadPreset() {
        const presetSelect = document.getElementById('presetSelect');
        const selectedPreset = presetSelect.value;
        
        if (!selectedPreset) return;
        
        console.log('ãƒ—ãƒªã‚»ãƒƒãƒˆåˆ‡ã‚Šæ›¿ãˆé–‹å§‹:', selectedPreset);
        
        // ãƒ—ãƒªã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿ä¸­ãƒ•ãƒ©ã‚°ã‚’è¨­å®šï¼ˆè‡ªå‹•ä¿å­˜ã‚’åœæ­¢ï¼‰
        isLoadingPreset = true;
        
        // ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãŒé¸ã°ã‚ŒãŸå ´åˆã¯è¨­å®šã‚’é©ç”¨ã—ã¦ã™ãã«å®Œäº†
        if (selectedPreset === 'default') {
            console.log('ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãƒ—ãƒªã‚»ãƒƒãƒˆå‡¦ç†é–‹å§‹');
            
            // è¨­å®šçŠ¶æ…‹ã‚’ä¿å­˜
            currentPreset = selectedPreset;
            try {
                localStorage.setItem('selectedPreset', selectedPreset);
                console.log('ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠçŠ¶æ…‹ã‚’ä¿å­˜:', selectedPreset);
            } catch (error) {
                console.error('localStorageä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
            }
            
            // ã¾ãšä¿å­˜æ¸ˆã¿ã®è¨­å®šãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            const savedPresets = JSON.parse(localStorage.jimakuChan_presets || '{}');
            let settingsToApply;
            
            if (savedPresets[selectedPreset] && savedPresets[selectedPreset].settings) {
                settingsToApply = savedPresets[selectedPreset].settings;
                console.log('ä¿å­˜æ¸ˆã¿ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä½¿ç”¨');
                console.log('ä¿å­˜æ¸ˆã¿è¨­å®šã®ä¸€éƒ¨:', {
                    bgcolor: settingsToApply.bgcolor,
                    trans: settingsToApply.trans,
                    speech_text_font_selector: settingsToApply.speech_text_font_selector
                });
            } else {
                settingsToApply = defaultPresets.default.settings;
                console.log('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä½¿ç”¨ï¼ˆä¿å­˜æ¸ˆã¿è¨­å®šãªã—ï¼‰');
            }
            
            // è¨­å®šã‚’é©ç”¨
            for (const [key, value] of Object.entries(settingsToApply)) {
                const element = document.getElementById(key);
                if (element) {
                    if (element.type === 'checkbox') {
                        element.checked = value;
                    } else {
                        element.value = value;
                    }
                }
            }
            
            // è¨­å®šã‚’åæ˜ 
            updateOptionValues(false);
            setTimeout(() => {
                applyAllSettings();
                selectFont(); // ãƒ•ã‚©ãƒ³ãƒˆçŠ¶æ…‹ã‚‚æ›´æ–°
                initializeSystemFontFields(); // PCå†…ãƒ•ã‚©ãƒ³ãƒˆã¨ç›´æ¥å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®çŠ¶æ…‹ã‚’å¾©å…ƒ
                updateVisualSettings(); // ã‚¹ãƒ©ã‚¤ãƒ‰ãƒãƒ¼æ•°å€¤è¡¨ç¤ºã‚’æ›´æ–°
                applyFrameHeight(); // frame_heightï¼ˆè¨­å®šç”»é¢è¡¨ç¤º/éè¡¨ç¤ºï¼‰ã‚’é©ç”¨
            }, 100);
            
            // ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ
            isLoadingPreset = false;
            updatePageTitle();
            
            // å¼·åˆ¶çš„ã«è‡ªå‹•ä¿å­˜ã‚’å®Ÿè¡Œ
            console.log('ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãƒ—ãƒªã‚»ãƒƒãƒˆ - å¼·åˆ¶è‡ªå‹•ä¿å­˜å®Ÿè¡Œ');
            setTimeout(saveCurrentPreset, 200);
            
            console.log('ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãƒ—ãƒªã‚»ãƒƒãƒˆå‡¦ç†å®Œäº†');
            return;
        }
        
        // é¸æŠçŠ¶æ…‹ã‚’ä¿å­˜
        currentPreset = selectedPreset;
        try {
            localStorage.setItem('selectedPreset', selectedPreset);
            console.log('ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠçŠ¶æ…‹ã‚’ä¿å­˜:', selectedPreset);
            console.log('ä¿å­˜ç¢ºèª:', localStorage.getItem('selectedPreset'));
        } catch (error) {
            console.error('localStorageä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        }
        
        let presetData = null;
        
        // ã¾ãšä¿å­˜ã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆå„ªå…ˆï¼‰
        const savedPresets = JSON.parse(localStorage.jimakuChan_presets || '{}');
        if (savedPresets[selectedPreset]) {
            presetData = savedPresets[selectedPreset].settings;
            console.log('ä¿å­˜æ¸ˆã¿ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨:', selectedPreset);
        } else if (defaultPresets[selectedPreset]) {
            // ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®ã¿ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä½¿ç”¨
            presetData = defaultPresets[selectedPreset].settings;
            console.log('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒªã‚»ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨:', selectedPreset);
        }
        
        if (presetData) {
            console.log('ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿é©ç”¨ä¸­:', Object.keys(presetData).length + 'å€‹ã®è¨­å®š');
            
            // è¨­å®šã‚’é©ç”¨
            for (const key in presetData) {
                const element = document.getElementById(key);
                if (element) {
                    if (element.type === 'checkbox') {
                        element.checked = presetData[key];
                    } else {
                        element.value = presetData[key];
                    }
                }
            }
            
            // ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šã®ç‰¹åˆ¥å‡¦ç†
            selectFont();
            
            // è¡¨ç¤ºã‚’æ›´æ–°ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å€¤è¡¨ç¤ºãªã©ï¼‰
            updateVisualSettings();
            
            // frame_heightï¼ˆè¨­å®šç”»é¢è¡¨ç¤º/éè¡¨ç¤ºï¼‰ã‚’é©ç”¨
            applyFrameHeight();
            
            // å¼·åˆ¶ãƒªãƒ­ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ç¢ºå®Ÿãªæ›´æ–°
            console.log('ãƒ—ãƒªã‚»ãƒƒãƒˆå¼·åˆ¶æ›´æ–°ã‚’å®Ÿè¡Œä¸­...');
            
            var iframe = document.getElementById('asr_frame');
            
            // è¨­å®šã‚’é©ç”¨
            updateOptionValues(false);
            
            // è¤‡æ•°å›ã®ãƒªãƒ­ãƒ¼ãƒ‰è©¦è¡Œã§ç¢ºå®Ÿæ€§ã‚’å‘ä¸Š
            var reloadAttempts = 0;
            var maxAttempts = 3;
            
            function attemptReload() {
                reloadAttempts++;
                console.log(`ãƒªãƒ­ãƒ¼ãƒ‰è©¦è¡Œ ${reloadAttempts}/${maxAttempts}`);
                
                // iframeã‚’å¼·åˆ¶ãƒªãƒ­ãƒ¼ãƒ‰
                var currentSrc = iframe.src;
                iframe.src = 'about:blank';
                
                setTimeout(function() {
                    iframe.src = currentSrc;
                    
                    // èª­ã¿è¾¼ã¿å®Œäº†ã‚’å¾…æ©Ÿ
                    iframe.onload = function() {
                        console.log(`ãƒªãƒ­ãƒ¼ãƒ‰å®Œäº† (${reloadAttempts}/${maxAttempts})`);
                        
                        setTimeout(function() {
                            try {
                                if (iframe.contentWindow && iframe.contentWindow.document) {
                                    console.log('DOMç›´æ¥æ›´æ–°å®Ÿè¡Œä¸­...');
                                    var settingsApplied = applyAllSettings();
                                    
                                    if (settingsApplied || reloadAttempts >= maxAttempts) {
                                        console.log('ãƒ—ãƒªã‚»ãƒƒãƒˆæ›´æ–°å®Œäº†');
                                        isLoadingPreset = false;
                                        
                                        // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
                                        updatePageTitle();
                                        
                                        // é€šå¸¸ã®onloadãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«æˆ»ã™
                                        iframe.onload = function() {
                                            console.log('iframeèª­ã¿è¾¼ã¿å®Œäº†');
                                            setTimeout(applyInitialSettings, 300);
                                        };
                                    } else {
                                        console.log('è¨­å®šé©ç”¨å¤±æ•— - å†è©¦è¡Œä¸­...');
                                        setTimeout(attemptReload, 500);
                                    }
                                } else {
                                    if (reloadAttempts < maxAttempts) {
                                        console.log('DOMæœªæº–å‚™ - å†è©¦è¡Œä¸­...');
                                        setTimeout(attemptReload, 500);
                                    } else {
                                        console.log('æœ€å¤§è©¦è¡Œå›æ•°ã«åˆ°é” - çµ‚äº†');
                                        isLoadingPreset = false;
                                        
                                        // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
                                        updatePageTitle();
                                        
                                        // é€šå¸¸ã®onloadãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«æˆ»ã™
                                        iframe.onload = function() {
                                            console.log('iframeèª­ã¿è¾¼ã¿å®Œäº†');
                                            setTimeout(applyInitialSettings, 300);
                                        };
                                    }
                                }
                            } catch (error) {
                                console.error('ãƒ—ãƒªã‚»ãƒƒãƒˆé©ç”¨ã‚¨ãƒ©ãƒ¼:', error);
                                if (reloadAttempts < maxAttempts) {
                                    setTimeout(attemptReload, 500);
                                } else {
                                    console.log('ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚Šå‡¦ç†çµ‚äº†');
                                    isLoadingPreset = false;
                                    
                                    // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
                                    updatePageTitle();
                                    
                                    // é€šå¸¸ã®onloadãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«æˆ»ã™
                                    iframe.onload = function() {
                                        console.log('iframeèª­ã¿è¾¼ã¿å®Œäº†');
                                        setTimeout(applyInitialSettings, 300);
                                    };
                                }
                            }
                        }, 500);
                    };
                }, 100);
            }
            
            // åˆå›è©¦è¡Œã‚’é–‹å§‹
            attemptReload();
            
            console.log('ãƒ—ãƒªã‚»ãƒƒãƒˆã€Œ' + selectedPreset + 'ã€ã‚’èª­ã¿è¾¼ã¿å®Œäº†');
        } else {
            console.error('ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', selectedPreset);
            isLoadingPreset = false;
            
            // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
            updatePageTitle();
        }
    }
    
    // ç¾åœ¨ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã«è¨­å®šã‚’è‡ªå‹•ä¿å­˜
    function saveCurrentPreset() {
        console.log('saveCurrentPresetå‘¼ã³å‡ºã— - currentPreset:', currentPreset, 'isLoadingPreset:', isLoadingPreset);
        
        if (!currentPreset || isLoadingPreset) {
            if (isLoadingPreset) console.log('ãƒ—ãƒªã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿ä¸­ã®ãŸã‚è‡ªå‹•ä¿å­˜ã‚’ã‚¹ã‚­ãƒƒãƒ—');
            if (!currentPreset) console.log('ç¾åœ¨ã®ãƒ—ãƒªã‚»ãƒƒãƒˆãŒæœªè¨­å®šã®ãŸã‚è‡ªå‹•ä¿å­˜ã‚’ã‚¹ã‚­ãƒƒãƒ—');
            return;
        }
        
        console.log('è‡ªå‹•ä¿å­˜é–‹å§‹ - ãƒ—ãƒªã‚»ãƒƒãƒˆ:', currentPreset);
        
        // ç¾åœ¨ã®è¨­å®šã‚’å–å¾—
        const currentSettings = {};
        for (const p of config_values) {
            const element = document.getElementById(p);
            if (element) {
                if (element.type === 'checkbox') {
                    currentSettings[p] = element.checked;
                } else {
                    currentSettings[p] = element.value;
                }
            }
        }
        
        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹è¨­å®šã‚‚å«ã‚ã‚‹
        currentSettings.bouyomi = document.getElementById('bouyomi').checked;
        currentSettings.anti_sexual = document.getElementById('anti_sexual').checked;
        
        // ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä¿å­˜
        const savedPresets = JSON.parse(localStorage.jimakuChan_presets || '{}');
        savedPresets[currentPreset] = {
            name: defaultPresets[currentPreset] ? defaultPresets[currentPreset].name : currentPreset,
            settings: currentSettings,
            lastModified: new Date().toISOString()
        };
        
        localStorage.jimakuChan_presets = JSON.stringify(savedPresets);
        console.log('ãƒ—ãƒªã‚»ãƒƒãƒˆã€Œ' + currentPreset + 'ã€ã«è‡ªå‹•ä¿å­˜ã—ã¾ã—ãŸ');
        console.log('ä¿å­˜ã•ã‚ŒãŸè¨­å®šã®ä¸€éƒ¨:', {
            bgcolor: currentSettings.bgcolor,
            size1: currentSettings.size1,
            color1: currentSettings.color1,
            recog: currentSettings.recog,
            trans: currentSettings.trans,
            speech_text_font_selector: currentSettings.speech_text_font_selector
        });
        
        // ä¿å­˜ç¢ºèªã®ãŸã‚ã€localStorageã‹ã‚‰èª­ã¿ç›´ã—
        const verifyPresets = JSON.parse(localStorage.jimakuChan_presets || '{}');
        if (verifyPresets[currentPreset]) {
            console.log('ä¿å­˜ç¢ºèªOK - ãƒ—ãƒªã‚»ãƒƒãƒˆã€Œ' + currentPreset + 'ã€ãŒå­˜åœ¨ã—ã¾ã™');
        } else {
            console.error('ä¿å­˜ç¢ºèªNG - ãƒ—ãƒªã‚»ãƒƒãƒˆã€Œ' + currentPreset + 'ã€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        }
    }
    
    // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šä¿å­˜ã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ç¢ºèª
    function debugPresets() {
        const savedPresets = JSON.parse(localStorage.jimakuChan_presets || '{}');
        console.log('=== ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆä¸€è¦§ ===');
        for (const [key, value] of Object.entries(savedPresets)) {
            console.log(`${key}:`, {
                name: value.name,
                lastModified: value.lastModified,
                settingsCount: Object.keys(value.settings).length,
                sampleSettings: {
                    bgcolor: value.settings.bgcolor,
                    size1: value.settings.size1,
                    recog: value.settings.recog,
                    trans: value.settings.trans
                }
            });
        }
        console.log('=== ç¾åœ¨ã®ãƒ—ãƒªã‚»ãƒƒãƒˆ ===', currentPreset);
    }
    
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰å®Ÿè¡Œå¯èƒ½ï¼‰
    window.debugPresets = debugPresets;
    
    // ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠçŠ¶æ…‹ã‚’ãƒ‡ãƒãƒƒã‚°ã™ã‚‹é–¢æ•°
    function debugPresetSelection() {
        console.log('=== ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠçŠ¶æ…‹ãƒ‡ãƒãƒƒã‚° ===');
        console.log('currentPresetå¤‰æ•°:', currentPreset);
        console.log('localStorage.selectedPreset:', localStorage.getItem('selectedPreset'));
        
        const presetSelect = document.getElementById('presetSelect');
        if (presetSelect) {
            console.log('ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®ç¾åœ¨å€¤:', presetSelect.value);
            console.log('ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®é¸æŠã•ã‚ŒãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³:', presetSelect.options[presetSelect.selectedIndex]?.text);
        } else {
            console.log('ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        }
    }
    
    window.debugPresetSelection = debugPresetSelection;
    
    // æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã®è‡ªå‹•ç§»è¡Œé–¢æ•°
    function migrateExistingUserSettings() {
        console.log('=== æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šç§»è¡Œãƒã‚§ãƒƒã‚¯é–‹å§‹ ===');
        
        // æ—§è¨­å®šã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯ï¼ˆæœ€åˆã«ç¢ºèªï¼‰
        const oldConfig = localStorage.getItem('jimakuChan_config');
        const migrationFlag = localStorage.getItem('jimakuChan_migrated');
        
        console.log('ç§»è¡ŒçŠ¶æ³ç¢ºèª:', {
            oldConfig: !!oldConfig,
            migrationFlag: migrationFlag,
            oldConfigLength: oldConfig ? oldConfig.length : 0
        });
        
        // æ—§è¨­å®šãŒãªã„å ´åˆã®å‡¦ç†
        if (!oldConfig) {
            console.log('æ—§è¨­å®šãªã— - ç§»è¡Œä¸è¦');
            if (migrationFlag !== 'true') {
                localStorage.setItem('jimakuChan_migrated', 'true');
                console.log('æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ç§»è¡Œãƒ•ãƒ©ã‚°è¨­å®š');
            }
            return;
        }
        
        // ç§»è¡Œæ¸ˆã¿ãƒ•ãƒ©ã‚°ãŒã‚ã‚‹ãŒæ—§è¨­å®šã‚‚æ®‹ã£ã¦ã„ã‚‹å ´åˆï¼ˆç§»è¡Œå¤±æ•—ã®å¯èƒ½æ€§ï¼‰
        if (migrationFlag === 'true' && oldConfig) {
            console.warn('âš ï¸ ç§»è¡Œæ¸ˆã¿ãƒ•ãƒ©ã‚°ãŒã‚ã‚‹ãŒæ—§è¨­å®šãŒæ®‹å­˜ - å†ç§»è¡Œã‚’å®Ÿè¡Œ');
            console.log('ã“ã®çŠ¶æ³ã¯ç§»è¡Œå¤±æ•—ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™');
        }
        
        try {
            const oldSettings = JSON.parse(oldConfig);
            console.log('æ—§è¨­å®šã‚’ç™ºè¦‹:', Object.keys(oldSettings).length + 'é …ç›®');
            console.log('æ—§è¨­å®šã‚µãƒ³ãƒ—ãƒ«:', {
                bgcolor: oldSettings.bgcolor,
                size1: oldSettings.size1,
                recog: oldSettings.recog,
                trans: oldSettings.trans
            });
            
            // ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãƒ—ãƒªã‚»ãƒƒãƒˆã®æ—¢å­˜ãƒã‚§ãƒƒã‚¯
            const savedPresets = JSON.parse(localStorage.getItem('jimakuChan_presets') || '{}');
            
            if (savedPresets['default'] && savedPresets['default'].settings) {
                console.log('ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãƒ—ãƒªã‚»ãƒƒãƒˆæ—¢å­˜ - æ—§è¨­å®šç§»è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—');
                // ç§»è¡Œæ¸ˆã¿ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
                localStorage.setItem('jimakuChan_migrated', 'true');
                return;
            }
            
            // æ—§è¨­å®šã‚’ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãƒ—ãƒªã‚»ãƒƒãƒˆã«ç§»è¡Œ
            console.log('æ—§è¨­å®šã‚’ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãƒ—ãƒªã‚»ãƒƒãƒˆã«ç§»è¡Œé–‹å§‹');
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒªã‚»ãƒƒãƒˆã®è¨­å®šé …ç›®ã«åˆã‚ã›ã¦ç§»è¡Œ
            const migratedSettings = {};
            
            // è¨­å®šé …ç›®ã®ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆconfig_valuesã¨å®Œå…¨ä¸€è‡´ï¼‰
            const settingKeys = [
                'gas_key', 'textAlign', 'v_align', 'whiteSpace', 'bgcolor', 'frame_height',
                'recog', 'size1', 'weight1', 'color1', 'st_color1', 'st_width1',
                'trans', 'size2', 'weight2', 'color2', 'st_color2', 'st_width2',
                'trans2', 'size3', 'weight3', 'color3', 'st_color3', 'st_width3',
                'trans3', 'size4', 'weight4', 'color4', 'st_color4', 'st_width4',
                'timer', 'short_pause', 'bouyomi', 'anti_sexual',
                'speech_text_font_selector', 'trans_text_font_selector', 
                'trans_text2_font_selector', 'trans_text3_font_selector',
                'speech_text_system_font', 'trans_text_system_font',
                'trans_text2_system_font', 'trans_text3_system_font'
            ];
            
            // æ—§è¨­å®šã‹ã‚‰æ–°è¨­å®šã«ã‚³ãƒ”ãƒ¼ï¼ˆè©³ç´°ãƒ­ã‚°ä»˜ãï¼‰
            console.log('=== è¨­å®šé …ç›®åˆ¥ç§»è¡ŒçŠ¶æ³ ===');
            let migratedCount = 0;
            let skippedCount = 0;
            
            settingKeys.forEach(key => {
                if (oldSettings.hasOwnProperty(key)) {
                    migratedSettings[key] = oldSettings[key];
                    console.log(`âœ… ${key}: "${oldSettings[key]}" -> ç§»è¡Œ`);
                    migratedCount++;
                } else {
                    console.log(`âš ï¸ ${key}: æ—§è¨­å®šã«å­˜åœ¨ã—ãªã„`);
                    skippedCount++;
                }
            });
            
            console.log(`ç§»è¡Œå®Œäº†: ${migratedCount}é …ç›®, ã‚¹ã‚­ãƒƒãƒ—: ${skippedCount}é …ç›®`);
            
            // ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šã®ç§»è¡Œï¼ˆæ—§ã‚·ã‚¹ãƒ†ãƒ å¯¾å¿œï¼‰
            if (oldSettings.speech_text_font && !migratedSettings.speech_text_font_selector) {
                migratedSettings.speech_text_font_selector = oldSettings.speech_text_font;
            }
            if (oldSettings.trans_text_font && !migratedSettings.trans_text_font_selector) {
                migratedSettings.trans_text_font_selector = oldSettings.trans_text_font;
            }
            if (oldSettings.trans_text2_font && !migratedSettings.trans_text2_font_selector) {
                migratedSettings.trans_text2_font_selector = oldSettings.trans_text2_font;
            }
            if (oldSettings.trans_text3_font && !migratedSettings.trans_text3_font_selector) {
                migratedSettings.trans_text3_font_selector = oldSettings.trans_text3_font;
            }
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ä¸è¶³é …ç›®ã‚’è£œå®Œ
            console.log('=== ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è£œå®Œå‡¦ç† ===');
            const defaultSettings = defaultPresets['default']?.settings || {};
            
            // åŸºæœ¬çš„ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
            const basicDefaults = {
                textAlign: 'center',
                v_align: 'top',
                bgcolor: '#00ff00',
                whiteSpace: '',
                recog: 'ja',
                size1: '25', weight1: '900', color1: '#ffffff', st_color1: '#000000', st_width1: '6',
                trans: 'none',
                size2: '25', weight2: '900', color2: '#ffffff', st_color2: '#000000', st_width2: '6',
                trans2: 'none',
                size3: '25', weight3: '900', color3: '#ffffff', st_color3: '#000000', st_width3: '6',
                trans3: 'none',
                size4: '25', weight4: '900', color4: '#ffffff', st_color4: '#000000', st_width4: '6',
                timer: '7000',
                short_pause: '750',
                bouyomi: false,
                anti_sexual: false,
                speech_text_font_selector: 'M PLUS Rounded\\ 1c',
                trans_text_font_selector: 'M PLUS Rounded\\ 1c',
                trans_text2_font_selector: 'M PLUS Rounded\\ 1c',
                trans_text3_font_selector: 'M PLUS Rounded\\ 1c',
                speech_text_system_font: '',
                trans_text_system_font: '',
                trans_text2_system_font: '',
                trans_text3_system_font: '',
                frame_height: '30%',
                gas_key: ''
            };
            
            let defaultCount = 0;
            settingKeys.forEach(key => {
                if (!migratedSettings.hasOwnProperty(key)) {
                    // ã¾ãšdefaultPresetsã‹ã‚‰è©¦ã™
                    if (defaultSettings.hasOwnProperty(key)) {
                        migratedSettings[key] = defaultSettings[key];
                        console.log(`ğŸ“ ${key}: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒªã‚»ãƒƒãƒˆã‹ã‚‰è£œå®Œ -> "${defaultSettings[key]}"`);
                    }
                    // æ¬¡ã«basicDefaultsã‹ã‚‰è©¦ã™
                    else if (basicDefaults.hasOwnProperty(key)) {
                        migratedSettings[key] = basicDefaults[key];
                        console.log(`ğŸ“ ${key}: åŸºæœ¬ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§è£œå®Œ -> "${basicDefaults[key]}"`);
                    }
                    else {
                        console.log(`âŒ ${key}: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãªã—`);
                    }
                    defaultCount++;
                }
            });
            
            console.log(`ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è£œå®Œ: ${defaultCount}é …ç›®`);
            
            // ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãƒ—ãƒªã‚»ãƒƒãƒˆã¨ã—ã¦ä¿å­˜
            savedPresets['default'] = {
                name: 'é¸æŠã—ã¦ãã ã•ã„',
                settings: migratedSettings,
                lastModified: new Date().toISOString(),
                migratedFrom: 'jimakuChan_config'
            };
            
            localStorage.setItem('jimakuChan_presets', JSON.stringify(savedPresets));
            
            // ç§»è¡Œå¾Œæ¤œè¨¼ï¼šå®Ÿéš›ã«ä¿å­˜ã•ã‚ŒãŸã‹ç¢ºèª
            console.log('=== ç§»è¡Œå¾Œæ¤œè¨¼ ===');
            const verifyPresets = JSON.parse(localStorage.getItem('jimakuChan_presets') || '{}');
            if (verifyPresets.default && verifyPresets.default.settings) {
                console.log('âœ… ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãƒ—ãƒªã‚»ãƒƒãƒˆä¿å­˜ç¢ºèªOK');
                console.log('ä¿å­˜ã•ã‚ŒãŸè¨­å®šé …ç›®æ•°:', Object.keys(verifyPresets.default.settings).length);
                
                // é‡è¦ãªè¨­å®šé …ç›®ã‚’å€‹åˆ¥ç¢ºèª
                const verifySettings = verifyPresets.default.settings;
                const criticalKeys = ['bgcolor', 'size1', 'recog', 'gas_key', 'timer'];
                console.log('=== é‡è¦è¨­å®šé …ç›®ç¢ºèª ===');
                criticalKeys.forEach(key => {
                    console.log(`${key}: "${verifySettings[key] || 'undefined'}"`);
                });
                
            } else {
                console.error('âŒ ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãƒ—ãƒªã‚»ãƒƒãƒˆä¿å­˜å¤±æ•—');
            }
            
            console.log('âœ… è¨­å®šç§»è¡Œå®Œäº†');
            console.log('ç§»è¡Œã•ã‚ŒãŸè¨­å®šé …ç›®æ•°:', Object.keys(migratedSettings).length);
            
            // ç§»è¡ŒæˆåŠŸæ™‚ã®ã¿ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
            localStorage.setItem('jimakuChan_migrated', 'true');
            
            // æ—§è¨­å®šã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨ã«ãƒªãƒãƒ¼ãƒ ï¼ˆå‰Šé™¤ã¯ã—ãªã„ï¼‰
            localStorage.setItem('jimakuChan_config_backup', oldConfig);
            console.log('æ—§è¨­å®šã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ã—ã¦ä¿å­˜: jimakuChan_config_backup');
            
            // ç§»è¡Œå®Œäº†å¾Œã€æ—§è¨­å®šã‚’å‰Šé™¤ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯ä¿æŒï¼‰
            localStorage.removeItem('jimakuChan_config');
            console.log('âœ… æ—§è¨­å®š(jimakuChan_config)ã‚’å‰Šé™¤ï¼ˆç§»è¡Œå®Œäº†ï¼‰');
            console.log('âœ… å…¨è¨­å®šã¯jimakuChan_presetsã§ç®¡ç†ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ');
            
        } catch (error) {
            console.error('âŒ è¨­å®šç§»è¡Œã‚¨ãƒ©ãƒ¼:', error);
            console.error('ç§»è¡Œã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ—§è¨­å®šã¨ãƒ•ãƒ©ã‚°ã¯ä¿æŒã•ã‚Œã¾ã™');
            // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ç§»è¡Œæ¸ˆã¿ãƒ•ãƒ©ã‚°ã‚’è¨­å®šã—ãªã„ï¼ˆå†è©¦è¡Œå¯èƒ½ã«ã™ã‚‹ï¼‰
            // localStorage.setItem('jimakuChan_migrated', 'true'); // ã“ã®è¡Œã‚’å‰Šé™¤
        }
    }
    
    // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šç§»è¡ŒçŠ¶æ³ç¢ºèªé–¢æ•°
    function debugMigrationStatus() {
        console.log('=== ç§»è¡ŒçŠ¶æ³ãƒ‡ãƒãƒƒã‚° ===');
        const oldConfig = localStorage.getItem('jimakuChan_config');
        const migrationFlag = localStorage.getItem('jimakuChan_migrated');
        const backup = localStorage.getItem('jimakuChan_config_backup');
        const presets = localStorage.getItem('jimakuChan_presets');
        
        console.log('æ—§è¨­å®š(jimakuChan_config):', !!oldConfig, oldConfig ? oldConfig.length + 'æ–‡å­—' : 'ãªã—');
        console.log('ç§»è¡Œãƒ•ãƒ©ã‚°(jimakuChan_migrated):', migrationFlag);
        console.log('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—(jimakuChan_config_backup):', !!backup);
        console.log('ãƒ—ãƒªã‚»ãƒƒãƒˆ(jimakuChan_presets):', !!presets);
        
        if (presets) {
            const presetsData = JSON.parse(presets);
            console.log('ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãƒ—ãƒªã‚»ãƒƒãƒˆ:', !!presetsData.default);
            if (presetsData.default) {
                console.log('ç§»è¡Œå…ƒæƒ…å ±:', presetsData.default.migratedFrom || 'ãªã—');
                console.log('è¨­å®šé …ç›®æ•°:', Object.keys(presetsData.default.settings || {}).length);
            }
        }
        
        return {
            hasOldConfig: !!oldConfig,
            migrationFlag: migrationFlag,
            hasBackup: !!backup,
            hasPresets: !!presets
        };
    }
    
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã™ã‚‹
    window.debugMigrationStatus = debugMigrationStatus;
    
    // å¼·åˆ¶å†ç§»è¡Œé–¢æ•°ï¼ˆãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç”¨ï¼‰
    function forceMigration() {
        console.log('=== å¼·åˆ¶å†ç§»è¡Œå®Ÿè¡Œ ===');
        localStorage.removeItem('jimakuChan_migrated');
        console.log('ç§»è¡Œãƒ•ãƒ©ã‚°ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        console.log('æ³¨æ„ï¼šã“ã®æ“ä½œã«ã‚ˆã‚Šã€æ—§è¨­å®š(jimakuChan_config)ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€');
        console.log('ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ãƒ—ãƒªã‚»ãƒƒãƒˆã«ç§»è¡Œã•ã‚Œã€æ—§è¨­å®šã¯å‰Šé™¤ã•ã‚Œã¾ã™');
        migrateExistingUserSettings();
        
        // ç§»è¡Œå¾Œã€ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦æ–°ã—ã„è¨­å®šã‚’åæ˜ 
        setTimeout(() => {
            console.log('ç§»è¡Œå®Œäº†å¾Œã€ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¾ã™...');
            location.reload();
        }, 1000);
    }
    
    window.forceMigration = forceMigration;
    
    // frame_heightï¼ˆè¨­å®šç”»é¢è¡¨ç¤º/éè¡¨ç¤ºï¼‰ã‚’é©ç”¨ã™ã‚‹é–¢æ•°
    function applyFrameHeight() {
        const frameHeightElement = document.getElementById('frame_height');
        const iframe = document.getElementById('asr_frame');
        const body = document.body;
        
        if (frameHeightElement && iframe) {
            const frameHeight = frameHeightElement.value || '30%';
            iframe.style.height = frameHeight;
            
            console.log('frame_heighté©ç”¨:', frameHeight);
            
            if (frameHeight === '100%') {
                body.style.overflow = 'hidden';  // ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç¦æ­¢ã™ã‚‹
            } else {
                body.style.overflow = 'auto';  // ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«ã™ã‚‹
            }
        }
    }
    
    // ãƒ—ãƒªã‚»ãƒƒãƒˆåˆæœŸåŒ–ï¼ˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œï¼‰
    function initializePresets() {
        console.log('=== ãƒ—ãƒªã‚»ãƒƒãƒˆåˆæœŸåŒ–é–‹å§‹ ===');
        const presetSelect = document.getElementById('presetSelect');
        
        if (!presetSelect) {
            console.error('ãƒ—ãƒªã‚»ãƒƒãƒˆã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            return;
        }
        
        // æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã®è‡ªå‹•ç§»è¡Œå‡¦ç†
        migrateExistingUserSettings();
        
        // localStorageã‹ã‚‰ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠçŠ¶æ…‹ã‚’å¾©å…ƒ
        const savedSelectedPreset = localStorage.getItem('selectedPreset');
        console.log('ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠçŠ¶æ…‹:', savedSelectedPreset);
        
        if (savedSelectedPreset) {
            currentPreset = savedSelectedPreset;
        } else {
            currentPreset = 'default'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
        }
        
        console.log('å¾©å…ƒã•ã‚ŒãŸcurrentPreset:', currentPreset);
        
        // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«å€¤ã‚’è¨­å®š
        presetSelect.value = currentPreset;
        
        // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®å€¤ãŒæ­£ã—ãè¨­å®šã•ã‚ŒãŸã‹ç¢ºèª
        console.log('ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³è¨­å®šå¾Œã®å€¤:', presetSelect.value);
        
        // å€¤ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã®å¯¾å‡¦
        if (presetSelect.value !== currentPreset) {
            console.warn('ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³è¨­å®šã«å¤±æ•—ã€æ‰‹å‹•ã§è¨­å®š:', currentPreset);
            // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
            const options = Array.from(presetSelect.options);
            const targetOption = options.find(option => option.value === currentPreset);
            if (targetOption) {
                targetOption.selected = true;
                console.log('æ‰‹å‹•è¨­å®šå®Œäº†');
            } else {
                console.error('æŒ‡å®šã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', currentPreset);
                currentPreset = 'default';
                presetSelect.value = currentPreset;
            }
        }
        
        // ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ã®å ´åˆã¯äº‹å‰ã«ä¿å­˜æ¸ˆã¿è¨­å®šã‚’å¾©å…ƒ
        if (currentPreset === 'default') {
            console.log('ã€Œé¸æŠã—ã¦ãã ã•ã„ã€ã®åˆæœŸåŒ– - ä¿å­˜æ¸ˆã¿è¨­å®šã‚’ãƒã‚§ãƒƒã‚¯');
            const savedPresets = JSON.parse(localStorage.jimakuChan_presets || '{}');
            
            if (savedPresets['default'] && savedPresets['default'].settings) {
                console.log('ä¿å­˜æ¸ˆã¿ã€Œé¸æŠã—ã¦ãã ã•ã„ã€è¨­å®šã‚’äº‹å‰å¾©å…ƒ');
                const savedSettings = savedPresets['default'].settings;
                
                // è¨­å®šã‚’UIã«äº‹å‰é©ç”¨
                for (const [key, value] of Object.entries(savedSettings)) {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = value;
                        } else {
                            element.value = value;
                        }
                    }
                }
            }
        }
        
        // å°‘ã—é…å»¶ã—ã¦ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’é©ç”¨ï¼ˆDOMæ§‹ç¯‰å®Œäº†ã‚’å¾…ã¤ï¼‰
        setTimeout(function() {
            console.log('initializePresetså†…ã§loadPresetå®Ÿè¡Œ');
            loadPreset();
        }, 50);
    }
    
    // è¡¨ç¤ºè¨­å®šã‚’æ›´æ–°ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ•°å€¤è¡¨ç¤ºï¼‰
    function updateVisualSettings() {
        console.log('ã‚¹ãƒ©ã‚¤ãƒ‰ãƒãƒ¼æ•°å€¤è¡¨ç¤ºã‚’æ›´æ–°ä¸­...');
        
        // å„ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤è¡¨ç¤ºã‚’æ›´æ–°
        for (let i = 1; i <= 4; i++) {
            const sizeElement = document.getElementById('size' + i);
            const weightElement = document.getElementById('weight' + i);
            const stWidthElement = document.getElementById('st_width' + i);
            
            const sizeViewElement = document.getElementById('text_size_view' + i);
            const weightViewElement = document.getElementById('text_weight_view' + i);
            const stSizeViewElement = document.getElementById('text_st_size_view' + i);
            
            if (sizeElement && sizeViewElement) {
                sizeViewElement.innerHTML = sizeElement.value;
                console.log('size' + i + 'è¡¨ç¤ºã‚’æ›´æ–°:', sizeElement.value);
            }
            if (weightElement && weightViewElement) {
                weightViewElement.innerHTML = weightElement.value;
                console.log('weight' + i + 'è¡¨ç¤ºã‚’æ›´æ–°:', weightElement.value);
            }
            if (stWidthElement && stSizeViewElement) {
                stSizeViewElement.innerHTML = stWidthElement.value;
                console.log('st_width' + i + 'è¡¨ç¤ºã‚’æ›´æ–°:', stWidthElement.value);
            }
        }
        
        // è¡Œé–“è¨­å®šã®è¡¨ç¤ºã‚’æ›´æ–°
        for (let i = 1; i <= 3; i++) {
            const lineSpacingElement = document.getElementById('line_spacing_' + i);
            const lineSpacingValueElement = document.getElementById('line_spacing_' + i + '_value');
            
            if (lineSpacingElement && lineSpacingValueElement) {
                lineSpacingValueElement.textContent = lineSpacingElement.value + 'px';
                console.log('line_spacing_' + i + 'è¡¨ç¤ºã‚’æ›´æ–°:', lineSpacingElement.value + 'px');
            }
        }
        
        console.log('ã‚¹ãƒ©ã‚¤ãƒ‰ãƒãƒ¼æ•°å€¤è¡¨ç¤ºæ›´æ–°å®Œäº†');
    }
</script>

<!-- # éŸ³å£°ãƒ¬ãƒ™ãƒ«ç›£è¦–æ©Ÿèƒ½ã€€############################ -->
<script>
    // éŸ³å£°ãƒ¬ãƒ™ãƒ«ç›£è¦–ç”¨ã®å¤‰æ•°
    let audioContext = null;
    let analyser = null;
    let microphone = null;
    let dataArray = null;
    
    // Web Speech APIã¯ãƒ‡ãƒã‚¤ã‚¹é¸æŠã‚’ã‚µãƒãƒ¼ãƒˆã—ãªã„ãŸã‚ã€ã“ã®æ©Ÿèƒ½ã¯ç„¡åŠ¹åŒ–
    function refreshAudioDevices() {
        console.log('Web Speech APIã®åˆ¶é™ã«ã‚ˆã‚Šã€éŸ³å£°ãƒ‡ãƒã‚¤ã‚¹é¸æŠã¯ä½¿ç”¨ã§ãã¾ã›ã‚“');
        console.log('æ—¢å®šã®éŸ³å£°å…¥åŠ›ãƒ‡ãƒã‚¤ã‚¹ã®ã¿ä½¿ç”¨ã•ã‚Œã¾ã™');
        // éŸ³å£°ãƒ¬ãƒ™ãƒ«ç›£è¦–ã®ã¿é–‹å§‹ï¼ˆãƒ‡ãƒã‚¤ã‚¹é¸æŠãªã—ï¼‰
        startAudioLevelMonitoring();
    }
    
    // éŸ³å£°ãƒ¬ãƒ™ãƒ«ç›£è¦–ã‚’é–‹å§‹ï¼ˆæ—¢å®šãƒ‡ãƒã‚¤ã‚¹ã®ã¿ä½¿ç”¨ï¼‰
    async function startAudioLevelMonitoring() {
        try {
            // Web Speech APIã®åˆ¶é™ã«ã‚ˆã‚Šã€å¸¸ã«æ—¢å®šãƒ‡ãƒã‚¤ã‚¹ã‚’ä½¿ç”¨
            // autoGainControlã‚’falseã«è¨­å®šã—ã¦è‡ªå‹•ã‚²ã‚¤ãƒ³èª¿æ•´ã‚’ç„¡åŠ¹åŒ–
            const constraints = { 
                audio: {
                    autoGainControl: false,
                    noiseSuppression: true,
                    echoCancellation: true
                }
            };
                
            const stream = await navigator.mediaDevices.getUserMedia(constraints);
            
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            microphone = audioContext.createMediaStreamSource(stream);
            
            analyser.fftSize = 256;
            const bufferLength = analyser.frequencyBinCount;
            dataArray = new Uint8Array(bufferLength);
            
            microphone.connect(analyser);
            
            updateAudioLevel();
            
        } catch (error) {
            console.error('éŸ³å£°ãƒ¬ãƒ™ãƒ«ç›£è¦–ã®é–‹å§‹ã«å¤±æ•—:', error);
        }
    }
    
    // éŸ³å£°ãƒ¬ãƒ™ãƒ«ç›£è¦–ã‚’åœæ­¢
    function stopAudioLevelMonitoring() {
        if (microphone) {
            microphone.disconnect();
            microphone = null;
        }
        if (audioContext) {
            audioContext.close();
            audioContext = null;
        }
        document.getElementById('audioLevelCover').style.width = '100%';
        document.getElementById('audioLevelText').textContent = '0%';
    }
    
    // éŸ³å£°ãƒ¬ãƒ™ãƒ«ã‚’æ›´æ–°
    function updateAudioLevel() {
        if (!analyser || !dataArray) return;
        
        analyser.getByteFrequencyData(dataArray);
        
        let sum = 0;
        for (let i = 0; i < dataArray.length; i++) {
            sum += dataArray[i];
        }
        const average = sum / dataArray.length;
        const level = Math.min(100, (average / 128) * 100);
        
        // ã‚«ãƒãƒ¼ã®å¹…ã‚’èª¿æ•´ï¼ˆãƒ¬ãƒ™ãƒ«ãŒé«˜ã„ã»ã©ã‚«ãƒãƒ¼ãŒç‹­ããªã‚‹ï¼‰
        document.getElementById('audioLevelCover').style.width = (100 - level) + '%';
        document.getElementById('audioLevelText').textContent = Math.round(level) + '%';
        
        // å¸¸ã«æ›´æ–°ã‚’ç¶šã‘ã‚‹
        requestAnimationFrame(updateAudioLevel);
    }
    
    // Web Speech APIã®åˆ¶é™ã«ã‚ˆã‚Šã€ãƒ‡ãƒã‚¤ã‚¹é¸æŠæ©Ÿèƒ½ã¯ç„¡åŠ¹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        // Font Access APIå¯¾å¿œçŠ¶æ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦è¡¨ç¤º
        checkFontAPIStatus();
        
        // éŸ³å£°ãƒ¬ãƒ™ãƒ«ç›£è¦–ã®ã¿é–‹å§‹ï¼ˆãƒ‡ãƒã‚¤ã‚¹é¸æŠãªã—ï¼‰
        refreshAudioDevices();
        
        // ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆé¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’åˆæœŸåŒ–
        setTimeout(initializeFontSelectors, 100);
        
        // ãƒ—ãƒªã‚»ãƒƒãƒˆåˆæœŸåŒ–ï¼ˆä¿å­˜æ¸ˆã¿è¨­å®šå¾©å…ƒï¼‰
        setTimeout(initializePresets, 200);
        
        // DOMèª­ã¿è¾¼ã¿å®Œäº†å¾Œã«è¨­å®šã‚’ç¢ºå®Ÿã«åæ˜ 
        setTimeout(applyInitialSettings, 800);
        
        // ã•ã‚‰ã«ç¢ºå®Ÿã«ã™ã‚‹ãŸã‚ã€è¿½åŠ ã®ã‚¿ã‚¤ãƒãƒ¼ã§ã‚‚å®Ÿè¡Œ
        setTimeout(applyInitialSettings, 1500);
    });
</script>

<!-- # ç¿»è¨³å›æ•°å–å¾—ã€€############################ -->
<script>
    function getTranslationCount() {
        var iframe = document.getElementById('asr_frame');
        var transCount = iframe.contentWindow.document.getElementById('translationCount').innerHTML;
        if(transCount == ''){
            transCount = '[ã‚³ã‚³ã«å›æ•°å‡ºã‚‹ã‚ˆï¼]';
        }
        return transCount;
    }

    // 1ç§’ã”ã¨ã«ç¿»è¨³ã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°
    setInterval(function() {
        document.getElementById('displayTransCount').innerHTML = getTranslationCount();
    }, 1000);
</script>

<!-- # iframeã®é«˜ã•ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã€€############################ -->
<script>
    function toggleIframeHeight() {
        console.log("toggleIframeHeight");
        var iframe = document.getElementById('asr_frame');
        var body = document.body;

        // ãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ä¸€ç•ªä¸Šã«æˆ»ã™
        window.scrollTo(0, 0);

        if (iframe.style.height === '100%') {
            iframe.style.height = '30%';
            body.style.overflow = 'auto';  // ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«ã™ã‚‹
        } else {
            iframe.style.height = '100%';
            body.style.overflow = 'hidden';  // ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç¦æ­¢ã™ã‚‹
        }

        document.getElementById('frame_height').value = iframe.style.height;
        updateOptionValues();
    }
</script>

<!-- iframeã®é«˜ã•ã‚’è‡ªå‹•èª¿æ•´ã™ã‚‹ -->
<script>
    window.addEventListener('load', function() {
        var iframe = document.getElementById('asr_frame');
        
        // iframeã®èª­ã¿è¾¼ã¿å®Œäº†ã‚’å¾…ã¤
        iframe.addEventListener('load', function() {
            try {
                var iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                iframeDoc.addEventListener('click', function() {
                    toggleIframeHeight();
                });
            } catch (e) {
                console.error('iframeã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«å¤±æ•—:', e);
            }
        });
        
        // ãƒšãƒ¼ã‚¸å…¨ä½“ã®ãƒ­ãƒ¼ãƒ‰å®Œäº†å¾Œã«è¨­å®šã‚’ç¢ºå®Ÿã«åæ˜ 
        setTimeout(applyInitialSettings, 1000);
    });
</script>

<!-- # ãƒ—ãƒªã‚»ãƒƒãƒˆåˆæœŸåŒ–ï¼ˆæœ€çµ‚å®Ÿè¡Œï¼‰ ###################### -->
<script>
    // ãƒšãƒ¼ã‚¸å®Œå…¨èª­ã¿è¾¼ã¿å¾Œã«ãƒ—ãƒªã‚»ãƒƒãƒˆåˆæœŸåŒ–ã‚’å®Ÿè¡Œ
    window.addEventListener('load', function() {
        console.log('ãƒšãƒ¼ã‚¸å®Œå…¨èª­ã¿è¾¼ã¿å®Œäº† - ãƒ—ãƒªã‚»ãƒƒãƒˆåˆæœŸåŒ–å®Ÿè¡Œ');
        
        // å°‘ã—é…å»¶ã—ã¦ç¢ºå®Ÿã«å®Ÿè¡Œ
        setTimeout(function() {
            console.log('ãƒ—ãƒªã‚»ãƒƒãƒˆåˆæœŸåŒ–é–‹å§‹');
            
            const presetSelect = document.getElementById('presetSelect');
            if (!presetSelect) {
                console.error('ãƒ—ãƒªã‚»ãƒƒãƒˆã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            // localStorageã‹ã‚‰ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠçŠ¶æ…‹ã‚’å¾©å…ƒ
            const savedSelectedPreset = localStorage.getItem('selectedPreset');
            console.log('ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠçŠ¶æ…‹:', savedSelectedPreset);
            
            if (savedSelectedPreset) {
                console.log('ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆã‚’å¾©å…ƒ:', savedSelectedPreset);
                presetSelect.value = savedSelectedPreset;
                
                // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®å€¤ãŒæ­£ã—ãè¨­å®šã•ã‚ŒãŸã‹ç¢ºèª
                if (presetSelect.value === savedSelectedPreset) {
                    console.log('ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³å¾©å…ƒæˆåŠŸ:', savedSelectedPreset);
                    // ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’å®Ÿéš›ã«èª­ã¿è¾¼ã‚€
                    const event = new Event('change');
                    presetSelect.dispatchEvent(event);
                } else {
                    console.error('ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³å¾©å…ƒå¤±æ•—:', savedSelectedPreset, 'ç¾åœ¨å€¤:', presetSelect.value);
                }
            } else {
                console.log('ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆãªã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨');
                presetSelect.value = 'default';
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒªã‚»ãƒƒãƒˆã‚’èª­ã¿è¾¼ã‚€
                const event = new Event('change');
                presetSelect.dispatchEvent(event);
            }
        }, 500);
    });
</script>

</html>